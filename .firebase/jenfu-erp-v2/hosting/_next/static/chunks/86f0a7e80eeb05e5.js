(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47821,e=>{"use strict";e.s(["materialCategories",0,[{code:"MECH",name:"機構零件",type:"part",description:"焊接件、加工件、鈑金、鋼構等機械零件",status:"active",sortOrder:10},{code:"ELEC",name:"電控零件",type:"part",description:"電機、電控相關元件與線材",status:"active",sortOrder:20},{code:"CHEM",name:"藥劑耗材",type:"purchase",description:"藥劑、濾材、耗材等採購品",status:"active",sortOrder:30},{code:"STD",name:"標準件",type:"part",description:"螺絲、束帶、氣壓配件等標準採購件",status:"active",sortOrder:40},{code:"PACK",name:"包材 / 配件",type:"other",description:"包裝材料、工具、組裝配件",status:"active",sortOrder:50}],"materials",0,[{code:"PS-00001",name:"BS3X5 下軸承座",spec:"3X5mm, SS400+鍍鋅",type:"PS",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-MAIN",preferredSupplierCode:"SUP0001",purchaseLeadTimeDays:12,stdCost:4500,currency:"TWD",status:"active",isStocked:!0,note:"標準採購件，適用油水分離機 BS 系列",isVariant:!1},{code:"PM-00001",name:"絞爪 3X5-2 用",spec:"2mm, 客製長 780mm",type:"PM",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-WIP",preferredSupplierCode:"SUP0002",purchaseLeadTimeDays:20,status:"active",isStocked:!1,note:"訂製件，目前僅供案號 2025-BS-021 使用",baseCode:"PM-00001",isVariant:!1},{code:"PO-00001",name:"除油劑 A 配方",spec:"液態 25L/桶",type:"PO",categoryCode:"CHEM",unitCode:"L",defaultWarehouseCode:"WH-MAT",preferredSupplierCode:"SUP0003",purchaseLeadTimeDays:15,stdCost:1800,currency:"TWD",status:"active",isStocked:!0,note:"採購品，需低溫存放",isVariant:!1},{code:"PM-00001-00001",name:"絞爪 3X5-2 客製尺寸 1",spec:"2mm, 客製長 820mm",type:"PM",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-WIP",preferredSupplierCode:"SUP0002",purchaseLeadTimeDays:20,status:"active",isStocked:!1,baseCode:"PM-00001",variantNo:"00001",isVariant:!0,note:"PM-00001 子料，案號 2025-BS-021 變形 A"}],"paymentTerms",0,[{code:"NET30",name:"貨到 30 天內付款",category:"net",netDays:30,status:"active",description:"出貨日 + 30 天付款",sortOrder:10},{code:"MONTH30",name:"月結 30 天",category:"monthly",monthlyOffset:30,status:"active",description:"每月月底結算，次月 30 日付款",sortOrder:20},{code:"COD",name:"貨到付現",category:"cash",status:"active",description:"交貨時付款",sortOrder:30},{code:"PREPAY30_70",name:"預付30%＋尾款70%",category:"installment",status:"active",description:"下單預付30%，出貨前付清剩餘70%",sortOrder:40},{code:"ON_HOLD",name:"暫停付款條款",category:"installment",status:"inactive",description:"僅留存紀錄，不提供新單據使用",sortOrder:90}],"sequences",0,[{key:"QUOTE",prefix:"QU",padding:4,nextNumber:128,scope:"報價"},{key:"ORDER",prefix:"SO",padding:5,nextNumber:3021,scope:"訂單"},{key:"WO",prefix:"WO",padding:5,nextNumber:873,scope:"製令"},{key:"SERIAL",prefix:"CFM",padding:6,nextNumber:54219,scope:"序號"},{key:"USER",prefix:"UA",padding:4,nextNumber:2,scope:"帳號"},{key:"EMPLOYEE",prefix:"JFS",padding:4,nextNumber:16,scope:"員工"},{key:"PART_PS",prefix:"PS-",padding:5,nextNumber:1,scope:"帳號"},{key:"PART_PM",prefix:"PM-",padding:5,nextNumber:1,scope:"帳號"},{key:"PART_PO",prefix:"PO-",padding:5,nextNumber:1,scope:"帳號"},{key:"SUPPLIER",prefix:"SUP",padding:4,nextNumber:4,scope:"帳號"}],"suppliers",0,[{code:"SUP0001",name:"亞鋼金屬",contact:"陳小姐",phone:"02-1234-5678",level:"A",leadTimeDays:12,status:"active",email:"sales@acm.com.tw",address:"台中市大肚區工業路 100 號",paymentTermCode:"MONTH30",taxId:"12345678",note:"主要供應 SS 板材"},{code:"SUP0002",name:"鑫泉幫浦",contact:"吳經理",phone:"04-8765-4321",level:"A",leadTimeDays:20,status:"active",email:"service@pump.com.tw",paymentTermCode:"NET30"},{code:"SUP0003",name:"沛富化工原料",contact:"林先生",phone:"07-2222-8888",level:"B",leadTimeDays:15,status:"suspended",note:"僅供偶爾訂單使用"}],"units",0,[{code:"EA",name:"台",category:"count",conversion:"1 台 = 1 件"},{code:"SET",name:"套",category:"count",conversion:"1 套 = 多件零組"},{code:"BAR",name:"條",category:"count",conversion:"1 條 = 1 件"},{code:"KG",name:"公斤",category:"weight",conversion:"1 kg = 1000 g"},{code:"L",name:"公升",category:"volume",conversion:"1 L = 1000 mL"},{code:"MM",name:"毫米",category:"length",conversion:"1 mm = 0.001 m"},{code:"LPM",name:"公升/分鐘",category:"flow",conversion:"1 LPM = 0.001 m³/min"},{code:"M3H",name:"立方米/小時",category:"flow",conversion:"1 m³/h = 16.67 LPM"},{code:"DEG-C",name:"攝氏度",category:"temperature",conversion:"基準溫標 °C"},{code:"DEG-F",name:"華氏度",category:"temperature",conversion:"°F = °C × 1.8 + 32"}],"warehouses",0,[{code:"WH-MAIN",name:"主倉",type:"raw",status:"active",isDefaultReceive:!0,isDefaultIssue:!0,sortOrder:10,address:"台中大肚廠內一樓",note:"零件材料主要存放區"},{code:"WH-MAT",name:"材料倉",type:"raw",status:"active",sortOrder:20,address:"台中大肚廠內二樓",note:"板金 / 型材 / 標準件"},{code:"WH-FG",name:"成品倉",type:"fg",status:"active",sortOrder:30,address:"台中大肚廠外成品棚"},{code:"WH-WIP",name:"組裝暫存區",type:"wip",status:"active",sortOrder:40,note:"組裝工位旁暫存架"},{code:"WH-OUT-TC",name:"外包倉-台中",type:"other",status:"active",sortOrder:50,note:"外包加工廠暫存"}]])},84616,43873,78598,e=>{"use strict";var t=e.i(71645);e.s(["DEPARTMENT_DEFINITIONS",0,{executive:{label:"經營",description:"決策／策略"},rd:{label:"研發",description:"產品與設計"},production:{label:"生產",description:"製造與現場"},sales:{label:"營銷",description:"業務與客服"},management:{label:"管理",description:"行政／管理"},finance:{label:"財務",description:"財會／稽核"}},"ROLE_DEFINITIONS",0,{admin:{label:"Admin",description:"序號調整、審核、最高權限",hierarchy:4},manager:{label:"Manager",description:"日常維運與審核啟動",hierarchy:3},planner:{label:"Planner",description:"草稿建立、流程規劃",hierarchy:2},operator:{label:"Operator",description:"查詢與執行現場作業",hierarchy:1}}],43873);let s={users:{label:"使用者",description:"帳號與權限"},employees:{label:"員工",description:"人事資料卡"},units:{label:"計量單位",description:"跨模組基本單位"},suppliers:{label:"供應商",description:"採購夥伴"},customers:{label:"客戶",description:"營銷對象"},parts:{label:"零件",description:"料號與成本"},products:{label:"產品",description:"BOM 與模組"},categories:{label:"類別",description:"物料分類"},files:{label:"檔案中心",description:"設計圖 / 圖片 / 附件"},sequences:{label:"序號",description:"Prefix / 流水"},quotes:{label:"報價",description:"報價單與交期"},orders:{label:"訂單",description:"接單與變更"},inventory:{label:"庫存",description:"入出庫與盤點"},production:{label:"產品/製令",description:"工單與製造履歷"},materials:{label:"物料",description:"零件與採購料主檔"}},a={view:"檢視",create:"新增",update:"編輯",disable:"停用",approve:"核准",lock:"鎖定","sequence-adjust":"調整序號",cancel:"作廢"},l={admin:{users:["view","create","update","disable","approve"],employees:["view","create","update","disable"],units:["view","create","update","disable","approve"],suppliers:["view","create","update","disable","approve"],customers:["view","create","update","disable","approve"],parts:["view","create","update","disable","approve"],products:["view","create","update","disable","approve"],categories:["view","create","update","disable","approve"],sequences:["view","lock","sequence-adjust","approve"],quotes:["view","create","update","approve","lock","cancel"],orders:["view","create","update","approve","lock","cancel"],inventory:["view","create","update","lock"],production:["view","create","update","approve","lock"],materials:["view","create","update","disable"],files:["view","create","update","disable"]},manager:{users:["view","create","update","disable"],employees:["view","create","update"],units:["view","create","update","disable"],suppliers:["view","create","update"],customers:["view","create","update"],parts:["view","create","update","disable"],products:["view","create","update"],categories:["view","create","update"],sequences:["view","lock"],quotes:["view","create","update","lock"],orders:["view","create","update","lock"],inventory:["view","create","update"],production:["view","create","update"],materials:["view","create","update"],files:["view","create","update"]},planner:{users:["view"],employees:["view","create"],units:["view","create"],suppliers:["view","create"],customers:["view","create"],parts:["view","create"],products:["view","create"],categories:["view","create"],sequences:["view"],quotes:["view","create"],orders:["view","create"],inventory:["view","create"],production:["view","create"],materials:["view","create"],files:["view","create"]},operator:{users:["view"],employees:["view"],units:["view"],suppliers:["view"],customers:["view"],parts:["view"],products:["view"],categories:["view"],sequences:["view"],quotes:["view"],orders:["view"],inventory:["view"],production:["view"],materials:["view"],files:["view"]}};function r(e,t){let s={users:[],employees:[],units:[],suppliers:[],customers:[],parts:[],products:[],categories:[],materials:[],files:[],sequences:[],quotes:[],orders:[],inventory:[],production:[]},{roleFilter:a,departmentFilter:r}=t??{},i=e.filter(e=>{let t=!a||e.role===a,s=!r||!e.departments.length||e.departments.includes(r);return t&&s});if(!i.length)return s;for(let e of i)Object.entries(l[e.role]).forEach(([e,t])=>{let a=new Set(s[e]);t.forEach(e=>a.add(e)),s[e]=Array.from(a)});return s}function i(e,t,s,a){let l=r(e,a);return l[t]?.includes(s)??!1}e.s(["ACTION_LABELS",()=>a,"MODULE_DEFINITIONS",()=>s,"buildPermissionProfile",()=>r,"canPerformAction",()=>i],78598);var d=e.i(57951);function n(e){let{assignments:s,roleFilter:a,departmentFilter:l}=e??{},{claims:n}=(0,d.useAuth)(),o=!!(s&&s.length),c=(0,t.useMemo)(()=>{if(!n?.roles?.length)return[];let e=n.departments??[];return n.roles.map(t=>({role:t,departments:e}))},[n?.departments,n?.roles]),m=(0,t.useMemo)(()=>{if(o&&s)return r(s,{roleFilter:a,departmentFilter:l});let e=n?.modules;if(e){let t=r(c,{roleFilter:a,departmentFilter:l});return Object.keys(t).forEach(s=>{let a=e[s];Array.isArray(a)&&(t[s]=a)}),t}return c.length?r(c,{roleFilter:a,departmentFilter:l}):null},[s,n?.modules,l,c,a,o]);return{profile:m,can:(e,t)=>{if(o&&s)return i(s,e,t,{roleFilter:a,departmentFilter:l});let r=m?.[e];return!!Array.isArray(r)&&r.includes(t)}}}e.s(["usePermission",()=>n],84616)},27379,e=>{"use strict";e.i(36180);var t=e.i(98925),s=e.i(74503);let a=new Map(e.i(47821).sequences.map(e=>[e.key,{...e}])),l=(0,t.collection)(s.db,"sequences");async function r(e){let r=a.get(e);if(!r)throw Error(`Sequence ${e} not found`);let i=await (0,t.runTransaction)(s.db,async s=>{let a=(0,t.doc)(l,e),i=await s.get(a),d={prefix:r.prefix,padding:r.padding,nextNumber:r.nextNumber};i.exists()&&(d=i.data());let n=`${d.prefix}${d.nextNumber.toString().padStart(d.padding,"0")}`;return s.set(a,{prefix:d.prefix,padding:d.padding,nextNumber:d.nextNumber+1},{merge:!0}),{value:n,issuedNumber:d.nextNumber}});return r.nextNumber=i.issuedNumber+1,{key:e,value:i.value,issuedNumber:i.issuedNumber}}e.s(["issueSequence",()=>r])},9348,e=>{"use strict";e.i(36180);var t=e.i(98925);e.i(61086);var s=e.i(27215),a=e.i(74503);async function l(e,s,l){let r=(await (0,t.getDocs)((0,t.query)((0,t.collection)(a.db,"files"),(0,t.where)("targetModule","==",e),(0,t.where)("entityId","==",s),(0,t.where)("isPrimary","==",!0)))).docs.filter(e=>e.id!==l).map(e=>(0,t.updateDoc)(e.ref,{isPrimary:!1}));await Promise.all(r)}async function r({module:e,entityId:r,files:i,metadata:d,createdBy:n}){if(!r.trim()||0===i.length)throw Error("entityId 和 files 為必填");let o=r.trim(),c=d?.title?.trim(),m=d?.description?.trim(),u=d?.tags?.filter(e=>e.trim())??[];d?.setPrimary&&await l(e,o);for(let l=0;l<i.length;l+=1){let r=i[l],x=`${e}/${o}/${Date.now()}-${r.name}`;await (0,s.uploadBytes)((0,s.ref)(a.storage,x),r),await (0,t.addDoc)((0,t.collection)(a.db,"files"),{targetModule:e,entityId:o,storagePath:x,fileName:r.name,mimeType:r.type||"application/octet-stream",size:r.size,title:c||r.name,description:m||null,tags:u,isPrimary:!!d?.setPrimary&&0===l,orderIndex:Date.now()+l,createdAt:(0,t.serverTimestamp)(),createdByUid:n?.uid??null,createdByName:n?.name??"system"})}}e.s(["clearExistingPrimary",()=>l,"uploadFilesForEntity",()=>r])},21443,e=>{"use strict";var t=e.i(43476),s=e.i(22016),a=e.i(71645);e.i(36180);var l=e.i(98925);e.i(61086);var r=e.i(27215),i=e.i(74503),d=e.i(27379),n=e.i(84616),o=e.i(43873),c=e.i(9348);let m=Object.entries(o.DEPARTMENT_DEFINITIONS).map(([e,t])=>({label:t.label,value:e})),u=[{label:"在職",value:"active"},{label:"留停",value:"on-leave"},{label:"離職",value:"inactive"}],x={keyword:"",department:"all",status:"all"},p=()=>({code:"",name:"",departments:[],title:"",status:"active",email:"",phone:"",hireDate:"",leaveDate:"",note:""}),h=e=>e?e.replace(/-/g,"/"):"—",b=e=>{if(!e?.toDate)return"";let t=e.toDate(),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${l}`},f=e=>e?e.replace(/\s+/g,"").slice(0,2).toUpperCase():"EMP";function v(){let{can:e}=(0,n.usePermission)(),v=e("employees","view"),y=e("employees","create"),g=e("employees","update"),N=e("files","view"),j=e("files","create");e("files","update");let[w,P]=(0,a.useState)([]),[S,C]=(0,a.useState)(x),[D,k]=(0,a.useState)(x),[E,T]=(0,a.useState)(!0),[A,O]=(0,a.useState)(null),[M,I]=(0,a.useState)(!1),[U,L]=(0,a.useState)(null),[R,q]=(0,a.useState)(()=>p()),[F,W]=(0,a.useState)(!1),[B,H]=(0,a.useState)(null),[$,_]=(0,a.useState)(!1),[z,G]=(0,a.useState)(null),[K,V]=(0,a.useState)(null),[X,Y]=(0,a.useState)(!1),[J,Q]=(0,a.useState)(null),[Z,ee]=(0,a.useState)(0),[et,es]=(0,a.useState)(!1),[ea,el]=(0,a.useState)({title:"",isPrimary:!0}),[er,ei]=(0,a.useState)(null),[ed,en]=(0,a.useState)(null),[eo,ec]=(0,a.useState)(null),[em,eu]=(0,a.useState)(!1),[ex,ep]=(0,a.useState)(null),eh=(0,a.useCallback)(async e=>{let t=await (0,l.getDocs)((0,l.query)((0,l.collection)(i.db,"files"),(0,l.where)("targetModule","==","employees"),(0,l.where)("entityId","==",e))),s=[];for(let a of t.docs){let t=a.data();if(t.deletedAt)continue;let l="string"==typeof t.mimeType?t.mimeType:"application/octet-stream";if(!l.startsWith("image/"))continue;let d={id:a.id,targetModule:"employees",entityId:t.entityId??e,storagePath:t.storagePath??"",fileName:t.fileName??a.id,mimeType:l,size:"number"==typeof t.size?t.size:void 0,title:t.title??void 0,description:t.description??void 0,tags:Array.isArray(t.tags)?t.tags:[],isPrimary:!0===t.isPrimary,orderIndex:"number"==typeof t.orderIndex?t.orderIndex:void 0,createdAt:t.createdAt,createdByUid:t.createdByUid??void 0,createdByName:t.createdByName??void 0,deletedAt:t.deletedAt};if(d.storagePath)try{d.downloadURL=await (0,r.getDownloadURL)((0,r.ref)(i.storage,d.storagePath))}catch{}s.push(d)}return s.sort((e,t)=>{if(e.isPrimary!==t.isPrimary)return e.isPrimary?-1:1;let s=e.orderIndex??e.createdAt?.toDate().getTime()??0;return(t.orderIndex??t.createdAt?.toDate().getTime()??0)-s}),s[0]??null},[]);(0,a.useEffect)(()=>{(async()=>{if(v)try{let e=(await (0,l.getDocs)((0,l.collection)(i.db,"employees"))).docs.map(e=>{let t=e.data();return{code:t.code??e.id,name:t.name??"",departments:Array.isArray(t.departments)?t.departments:[],title:t.title??"",status:t.status??"active",email:t.email??"",phone:t.phone??"",note:t.note??"",hireDate:b(t.hireDate),leaveDate:b(t.leaveDate)}});P(e)}catch(e){console.error("Failed to load employees",e),O("讀取員工資料失敗，請稍後再試。")}finally{T(!1)}})()},[v]),(0,a.useEffect)(()=>{if(M||z){let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[M,z]),(0,a.useEffect)(()=>{if(!z)return void V(null);let e=!0;return Y(!0),eh(z.code).then(t=>{e&&V(t)}).finally(()=>{e&&Y(!1)}),()=>{e=!1}},[z,eh,Z]),(0,a.useEffect)(()=>{if(!M||!U)return void Q(null);let e=!0;return eh(U).then(t=>{e&&Q(t)}).finally(()=>void 0),()=>{e=!1}},[M,U,eh,Z]);let eb=(0,a.useMemo)(()=>w.filter(e=>{let t=[e.code,e.name,e.title,e.email,e.phone].join(" ").toLowerCase(),s=!D.keyword||t.includes(D.keyword.toLowerCase()),a="all"===D.department||e.departments.includes(D.department),l="all"===D.status||e.status===D.status;return s&&a&&l}),[D,w]),ef=(e,t)=>{q(s=>({...s,[e]:t}))},ev=async e=>{W(e),q(t=>({...t,code:e?"JFS0000":""}))},ey=()=>{I(!1),L(null),q(p()),H(null),W(!1)},eg=()=>{es(!1),ei(null),en(null),ec(null)},eN=async e=>{if(e.preventDefault(),!U)return;let t=er?Array.from(er).slice(0,1):[];if(0===t.length)return void en("請選擇一張圖片");eu(!0),en(null),ec(null);try{await (0,c.uploadFilesForEntity)({module:"employees",entityId:U,files:t,metadata:{title:ea.title.trim()||void 0,tags:["avatar"],setPrimary:ea.isPrimary},createdBy:{uid:i.auth.currentUser?.uid??null,name:i.auth.currentUser?.email??i.auth.currentUser?.displayName??"system"}}),ec("已上傳照片"),ei(null),ee(e=>e+1)}catch(e){console.error("Failed to upload avatar",e),en("上傳失敗，請稍後再試。")}finally{eu(!1)}},ej=async e=>{if(e.preventDefault(),!y&&!g||$)return;let t=!U&&!F,s=R.code.trim().toUpperCase(),a=R.name.trim();if(!a)return void H("請輸入姓名");if(!R.departments.length)return void H("至少勾選一個部門");if(t)try{let e=await (0,d.issueSequence)("EMPLOYEE");s=e.value,q(t=>({...t,code:e.value}))}catch{H("取得員工編號時發生問題，請稍後再試。");return}if(!s)return void H("請輸入員工編號");let r=R.hireDate?l.Timestamp.fromDate(new Date(R.hireDate)):null,n=R.leaveDate?l.Timestamp.fromDate(new Date(R.leaveDate)):null;_(!0),H(null);try{await (0,l.setDoc)((0,l.doc)(i.db,"employees",s),{code:s,name:a,departments:R.departments,title:R.title.trim()||null,status:R.status,email:R.email.trim()||null,phone:R.phone.trim()||null,note:R.note.trim()||null,hireDate:r,leaveDate:n,updatedAt:(0,l.serverTimestamp)(),...U?{}:{createdAt:(0,l.serverTimestamp)()}},{merge:!0}),P(e=>{let t=e.filter(e=>e.code!==s);return t.push({code:s,name:a,departments:R.departments,title:R.title.trim()||void 0,status:R.status,email:R.email.trim()||void 0,phone:R.phone.trim()||void 0,note:R.note.trim()||void 0,hireDate:R.hireDate||void 0,leaveDate:R.leaveDate||void 0}),t}),ey()}catch(e){console.error("Failed to save employee",e),H("儲存員工資料時發生錯誤，請稍後再試。")}finally{_(!1)}};return v?(0,t.jsxs)("div",{className:"space-y-6",children:[M&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:U?"Edit":"Create"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:U?`編輯員工 ${R.code}`:"新增員工"})]}),(0,t.jsx)("button",{onClick:ey,className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("form",{onSubmit:ej,className:"mt-4 space-y-4",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["員工編號",(0,t.jsx)("input",{type:"text",value:R.code,readOnly:!!U||!F,onChange:e=>ef("code",e.target.value.toUpperCase()),className:`mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none ${U||!F?"bg-slate-100":""}`})]}),!U&&(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:F,onChange:e=>ev(e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"手動輸入既有編號"]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["姓名",(0,t.jsx)("input",{type:"text",value:R.name,onChange:e=>ef("name",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["職稱",(0,t.jsx)("input",{type:"text",value:R.title,onChange:e=>ef("title",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["Email",(0,t.jsx)("input",{type:"email",value:R.email,onChange:e=>ef("email",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["聯絡電話",(0,t.jsx)("input",{type:"text",value:R.phone,onChange:e=>ef("phone",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["入職日期",(0,t.jsx)("input",{type:"date",value:R.hireDate,onChange:e=>ef("hireDate",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["離職日期（選填）",(0,t.jsx)("input",{type:"date",value:R.leaveDate,onChange:e=>ef("leaveDate",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["狀態",(0,t.jsx)("select",{value:R.status,onChange:e=>ef("status",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:u.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"部門"}),(0,t.jsx)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:m.map(e=>{let s=R.departments.includes(e.value);return(0,t.jsxs)("label",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:s,onChange:()=>{var t;return t=e.value,void q(e=>{let s=e.departments.includes(t);return{...e,departments:s?e.departments.filter(e=>e!==t):[...e.departments,t]}})},className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),(0,t.jsx)("span",{children:e.label})]},e.value)})})]}),U?(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"照片 / 檔案"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"檔案儲存在檔案中心 · 員工模組"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[j&&(0,t.jsx)("button",{type:"button",onClick:()=>{U&&(el({title:R.name?`${R.name} 大頭照`:`${U} 大頭照`,isPrimary:!0}),ei(null),en(null),ec(null),es(!0))},className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-700 hover:border-teal-500 hover:text-teal-600",children:"上傳大頭照"}),N&&(0,t.jsx)(s.default,{href:`/master/files?module=employees&entityId=${encodeURIComponent(U)}`,className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-700 hover:border-teal-500 hover:text-teal-600",children:"開啟檔案中心"})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex items-center gap-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{J?.downloadURL&&ep(J)},className:"group relative h-24 w-24 overflow-hidden rounded-2xl border border-slate-200 bg-slate-50",children:J?.downloadURL?(0,t.jsx)("img",{src:J.downloadURL,alt:J.fileName,className:"h-full w-full object-cover transition group-hover:scale-105"}):(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-slate-100 text-sm font-semibold text-slate-500",children:f(R.name||U)})}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:J?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"font-semibold text-slate-700",children:J.title??J.fileName}),(0,t.jsx)("p",{children:J.mimeType})]}):(0,t.jsx)("p",{children:"尚未上傳大頭照"})})]}),!j&&(0,t.jsx)("p",{className:"mt-3 text-xs text-slate-400",children:"目前帳號沒有檔案上傳權限。"})]}):(0,t.jsx)("section",{className:"rounded-2xl border border-dashed border-slate-200 p-4 text-xs text-slate-500",children:"儲存後即可上傳照片（需先建立員工編號）"}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["備註",(0,t.jsx)("textarea",{value:R.note,onChange:e=>ef("note",e.target.value),rows:3,className:"mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"證照、備註或特殊資格"})]}),B&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:B}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:ey,className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"取消"}),(0,t.jsx)("button",{type:"submit",disabled:$,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:opacity-50",children:$?"儲存中…":U?"更新資料":"建立員工"})]})]})]})}),z&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Profile"}),(0,t.jsxs)("h2",{className:"text-xl font-semibold text-slate-900",children:[z.name," · ",z.code]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{K?.downloadURL&&ep(K)},className:"group relative h-24 w-24 overflow-hidden rounded-3xl border border-slate-200 bg-slate-50",children:X?(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center text-xs text-slate-500",children:"載入中…"}):K?.downloadURL?(0,t.jsx)("img",{src:K.downloadURL,alt:K.fileName,className:"h-full w-full object-cover transition group-hover:scale-105"}):(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-slate-100 text-sm font-semibold text-slate-500",children:f(z.name||z.code)})}),(0,t.jsx)("p",{className:"text-[11px] text-slate-400",children:K?K.title??K.fileName:"尚未上傳照片"})]}),(0,t.jsx)("button",{onClick:()=>{G(null)},className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]})]}),(0,t.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"基本資料"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"職稱"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:z.title||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"狀態"}),(0,t.jsx)("span",{className:`mt-1 inline-flex rounded-full px-3 py-1 text-xs font-semibold ${"active"===z.status?"bg-emerald-50 text-emerald-700":"on-leave"===z.status?"bg-amber-50 text-amber-700":"bg-slate-100 text-slate-500"}`,children:u.find(e=>e.value===z.status)?.label??z.status})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"部門"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:z.departments.map(e=>o.DEPARTMENT_DEFINITIONS[e]?.label??e).join(" / ")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"入職日期"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-700",children:h(z.hireDate)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"離職日期"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-700",children:h(z.leaveDate)})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"聯絡資訊"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"Email"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:z.email||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"電話"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:z.phone||"—"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"備註"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-slate-700",children:z.note?.trim()||"—"})]})]})]})}),ex&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Preview"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:ex.title??ex.fileName}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:ex.mimeType})]}),(0,t.jsx)("button",{onClick:()=>ep(null),className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsx)("div",{className:"mt-4 rounded-2xl border border-slate-100 bg-slate-50 p-4",children:ex.downloadURL?(0,t.jsx)("img",{src:ex.downloadURL,alt:ex.fileName,className:"max-h-[70vh] w-full rounded-xl object-contain"}):(0,t.jsx)("div",{className:"flex h-64 items-center justify-center text-sm text-slate-500",children:"無法預覽此檔案"})})]})}),et&&U&&(0,t.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Upload"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"上傳大頭照"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"完成後會自動儲存到檔案中心 · 員工模組"})]}),(0,t.jsx)("button",{onClick:eg,className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("form",{onSubmit:eN,className:"mt-4 space-y-4",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["主檔編號",(0,t.jsx)("input",{type:"text",value:U,readOnly:!0,className:"mt-1 w-full rounded-xl border border-slate-200 bg-slate-100 px-4 py-2 text-sm"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["照片標題",(0,t.jsx)("input",{type:"text",value:ea.title,onChange:e=>el(t=>({...t,title:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:ea.isPrimary,onChange:e=>el(t=>({...t,isPrimary:e.target.checked})),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"設為主照片"]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["選擇圖片",(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>ei(e.target.files),className:"mt-1 w-full text-sm"}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"建議 2MB 以下、JPG / PNG"})]}),ed&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:ed}),eo&&(0,t.jsx)("p",{className:"text-sm font-semibold text-emerald-600",children:eo}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:eg,className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"取消"}),(0,t.jsx)("button",{type:"submit",disabled:em,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:opacity-50",children:em?"上傳中…":"開始上傳"})]})]})]})}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Employees"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"員工主檔"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"統一的人事編號與部門資料，支援後續工時與排班模組。"})]}),y&&(0,t.jsx)("button",{onClick:()=>{L(null),W(!1),q(p()),H(null),I(!0)},className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white",children:"新增員工"})]}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),k(S)},className:"mt-6 grid gap-4 rounded-2xl bg-slate-50/80 p-4 md:grid-cols-4",children:[(0,t.jsxs)("label",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"搜尋關鍵字"}),(0,t.jsx)("input",{type:"text",value:S.keyword,onChange:e=>C(t=>({...t,keyword:e.target.value})),placeholder:"姓名 / 編號 / 職稱 / Email",className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"部門"}),(0,t.jsxs)("select",{value:S.department,onChange:e=>C(t=>({...t,department:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"all",children:"全部部門"}),m.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"狀態"}),(0,t.jsxs)("select",{value:S.status,onChange:e=>C(t=>({...t,status:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"all",children:"全部狀態"}),u.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,t.jsxs)("div",{className:"flex items-end gap-2 md:col-span-4 md:justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{C(x),k(x)},className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"重置"}),(0,t.jsx)("button",{type:"submit",className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm",children:"套用搜尋"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:(0,t.jsx)("p",{className:"text-sm text-slate-500",children:E?"載入中…":`已篩選 ${eb.length} 位員工（共 ${w.length} 位）`})}),A&&(0,t.jsx)("p",{className:"mt-3 text-xs font-semibold text-red-600",children:A}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto rounded-xl border border-slate-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsx)("tr",{children:["編號","姓名 / 職稱","部門","狀態","入職日","操作"].map(e=>(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:e},e))})}),(0,t.jsxs)("tbody",{className:"divide-y divide-slate-50",children:[eb.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-slate-50/70",children:[(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 font-semibold text-slate-900",children:e.code}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:e.title||"—"})]}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-slate-700",children:e.departments.map(e=>o.DEPARTMENT_DEFINITIONS[e]?.label??e).join(" / ")}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${"active"===e.status?"bg-emerald-50 text-emerald-700":"on-leave"===e.status?"bg-amber-50 text-amber-700":"bg-slate-100 text-slate-500"}`,children:u.find(t=>t.value===e.status)?.label??e.status})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-xs text-slate-500",children:h(e.hireDate)}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{G(e)},className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600",children:"檢視"}),g&&(0,t.jsx)("button",{type:"button",onClick:()=>{L(e.code),W(!0),q({code:e.code,name:e.name,departments:e.departments,title:e.title??"",status:e.status,email:e.email??"",phone:e.phone??"",hireDate:e.hireDate??"",leaveDate:e.leaveDate??"",note:e.note??""}),H(null),I(!0)},className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600",children:"編輯"})]})})]},e.code)),!eb.length&&!E&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"px-4 py-6 text-center text-sm text-slate-500",children:"尚無符合條件的員工資料"})})]})]})})]})]}):(0,t.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-sm text-slate-600",children:"目前帳號尚未獲得「員工主檔」權限，請聯絡系統管理員。"})}e.s(["EmployeeDirectory",()=>v])}]);