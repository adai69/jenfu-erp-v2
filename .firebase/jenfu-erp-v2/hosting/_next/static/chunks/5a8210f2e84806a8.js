(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47821,e=>{"use strict";e.s(["materialCategories",0,[{code:"MECH",name:"機構零件",type:"part",description:"焊接件、加工件、鈑金、鋼構等機械零件",status:"active",sortOrder:10},{code:"ELEC",name:"電控零件",type:"part",description:"電機、電控相關元件與線材",status:"active",sortOrder:20},{code:"CHEM",name:"藥劑耗材",type:"purchase",description:"藥劑、濾材、耗材等採購品",status:"active",sortOrder:30},{code:"STD",name:"標準件",type:"part",description:"螺絲、束帶、氣壓配件等標準採購件",status:"active",sortOrder:40},{code:"PACK",name:"包材 / 配件",type:"other",description:"包裝材料、工具、組裝配件",status:"active",sortOrder:50}],"materials",0,[{code:"PS-00001",name:"BS3X5 下軸承座",spec:"3X5mm, SS400+鍍鋅",type:"PS",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-MAIN",preferredSupplierCode:"SUP0001",purchaseLeadTimeDays:12,stdCost:4500,currency:"TWD",status:"active",isStocked:!0,note:"標準採購件，適用油水分離機 BS 系列",isVariant:!1},{code:"PM-00001",name:"絞爪 3X5-2 用",spec:"2mm, 客製長 780mm",type:"PM",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-WIP",preferredSupplierCode:"SUP0002",purchaseLeadTimeDays:20,status:"active",isStocked:!1,note:"訂製件，目前僅供案號 2025-BS-021 使用",baseCode:"PM-00001",isVariant:!1},{code:"PO-00001",name:"除油劑 A 配方",spec:"液態 25L/桶",type:"PO",categoryCode:"CHEM",unitCode:"L",defaultWarehouseCode:"WH-MAT",preferredSupplierCode:"SUP0003",purchaseLeadTimeDays:15,stdCost:1800,currency:"TWD",status:"active",isStocked:!0,note:"採購品，需低溫存放",isVariant:!1},{code:"PM-00001-00001",name:"絞爪 3X5-2 客製尺寸 1",spec:"2mm, 客製長 820mm",type:"PM",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-WIP",preferredSupplierCode:"SUP0002",purchaseLeadTimeDays:20,status:"active",isStocked:!1,baseCode:"PM-00001",variantNo:"00001",isVariant:!0,note:"PM-00001 子料，案號 2025-BS-021 變形 A"}],"paymentTerms",0,[{code:"NET30",name:"貨到 30 天內付款",category:"net",netDays:30,status:"active",description:"出貨日 + 30 天付款",sortOrder:10},{code:"MONTH30",name:"月結 30 天",category:"monthly",monthlyOffset:30,status:"active",description:"每月月底結算，次月 30 日付款",sortOrder:20},{code:"COD",name:"貨到付現",category:"cash",status:"active",description:"交貨時付款",sortOrder:30},{code:"PREPAY30_70",name:"預付30%＋尾款70%",category:"installment",status:"active",description:"下單預付30%，出貨前付清剩餘70%",sortOrder:40},{code:"ON_HOLD",name:"暫停付款條款",category:"installment",status:"inactive",description:"僅留存紀錄，不提供新單據使用",sortOrder:90}],"sequences",0,[{key:"QUOTE",prefix:"QU",padding:4,nextNumber:128,scope:"報價"},{key:"ORDER",prefix:"SO",padding:5,nextNumber:3021,scope:"訂單"},{key:"WO",prefix:"WO",padding:5,nextNumber:873,scope:"製令"},{key:"SERIAL",prefix:"CFM",padding:6,nextNumber:54219,scope:"序號"},{key:"USER",prefix:"JFS",padding:4,nextNumber:1,scope:"帳號"},{key:"PART_PS",prefix:"PS-",padding:5,nextNumber:1,scope:"帳號"},{key:"PART_PM",prefix:"PM-",padding:5,nextNumber:1,scope:"帳號"},{key:"PART_PO",prefix:"PO-",padding:5,nextNumber:1,scope:"帳號"},{key:"SUPPLIER",prefix:"SUP",padding:4,nextNumber:4,scope:"帳號"}],"suppliers",0,[{code:"SUP0001",name:"亞鋼金屬",contact:"陳小姐",phone:"02-1234-5678",level:"A",leadTimeDays:12,status:"active",email:"sales@acm.com.tw",address:"台中市大肚區工業路 100 號",paymentTermCode:"MONTH30",taxId:"12345678",note:"主要供應 SS 板材"},{code:"SUP0002",name:"鑫泉幫浦",contact:"吳經理",phone:"04-8765-4321",level:"A",leadTimeDays:20,status:"active",email:"service@pump.com.tw",paymentTermCode:"NET30"},{code:"SUP0003",name:"沛富化工原料",contact:"林先生",phone:"07-2222-8888",level:"B",leadTimeDays:15,status:"suspended",note:"僅供偶爾訂單使用"}],"units",0,[{code:"EA",name:"台",category:"count",conversion:"1 台 = 1 件"},{code:"SET",name:"套",category:"count",conversion:"1 套 = 多件零組"},{code:"BAR",name:"條",category:"count",conversion:"1 條 = 1 件"},{code:"KG",name:"公斤",category:"weight",conversion:"1 kg = 1000 g"},{code:"L",name:"公升",category:"volume",conversion:"1 L = 1000 mL"},{code:"MM",name:"毫米",category:"length",conversion:"1 mm = 0.001 m"},{code:"LPM",name:"公升/分鐘",category:"flow",conversion:"1 LPM = 0.001 m³/min"},{code:"M3H",name:"立方米/小時",category:"flow",conversion:"1 m³/h = 16.67 LPM"},{code:"DEG-C",name:"攝氏度",category:"temperature",conversion:"基準溫標 °C"},{code:"DEG-F",name:"華氏度",category:"temperature",conversion:"°F = °C × 1.8 + 32"}],"users",0,[{id:"U-001",name:"張仕杰",primaryRole:"admin",roles:[{role:"admin",departments:["executive","rd","finance","management"],isPrimary:!0},{role:"manager",departments:["rd","finance"]}],departments:["executive","rd","finance","management"],email:"ceo@cfm.com",status:"active",moduleOverrides:{quotes:["approve","lock","cancel"],orders:["approve","lock","cancel"]}},{id:"U-002",name:"張成漢",primaryRole:"manager",roles:[{role:"manager",departments:["production","sales"],isPrimary:!0},{role:"operator",departments:["production"]}],departments:["production","sales"],email:"operation@cfm.com",status:"active",moduleOverrides:{inventory:["lock"],production:["lock"]}},{id:"U-003",name:"張祐豪",primaryRole:"planner",roles:[{role:"planner",departments:["management","sales"],isPrimary:!0},{role:"manager",departments:["management"]}],departments:["management","sales"],email:"planner@cfm.com",status:"active"},{id:"U-004",name:"阮梓明",primaryRole:"operator",roles:[{role:"operator",departments:["production"]}],departments:["production"],email:"worker.vn@cfm.com",status:"active"}],"warehouses",0,[{code:"WH-MAIN",name:"主倉",type:"raw",status:"active",isDefaultReceive:!0,isDefaultIssue:!0,sortOrder:10,address:"台中大肚廠內一樓",note:"零件材料主要存放區"},{code:"WH-MAT",name:"材料倉",type:"raw",status:"active",sortOrder:20,address:"台中大肚廠內二樓",note:"板金 / 型材 / 標準件"},{code:"WH-FG",name:"成品倉",type:"fg",status:"active",sortOrder:30,address:"台中大肚廠外成品棚"},{code:"WH-WIP",name:"組裝暫存區",type:"wip",status:"active",sortOrder:40,note:"組裝工位旁暫存架"},{code:"WH-OUT-TC",name:"外包倉-台中",type:"other",status:"active",sortOrder:50,note:"外包加工廠暫存"}]])},96576,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(36180);var a=e.i(98925),r=e.i(74503),o=e.i(47821);let l=[{label:"全部類型",value:"all"},{label:"現金 / COD",value:"cash"},{label:"貨到 N 天",value:"net"},{label:"月結",value:"monthly"},{label:"預付 / 分期",value:"installment"}],n=[{label:"全部狀態",value:"all"},{label:"使用中",value:"active"},{label:"停用",value:"inactive"}],d={keyword:"",category:"all",status:"all"},c=()=>({code:"",name:"",category:"net",status:"active",description:"",netDays:"",monthlyOffset:"",sortOrder:""});function i(){let[e,i]=(0,s.useState)(o.paymentTerms),[m,u]=(0,s.useState)(!0),[p,x]=(0,s.useState)(d),[y,f]=(0,s.useState)(d),[b,h]=(0,s.useState)(!1),[v,g]=(0,s.useState)(null),[N,j]=(0,s.useState)(()=>c()),[w,C]=(0,s.useState)(null),[O,S]=(0,s.useState)(null),[P,k]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{try{let e=(await (0,a.getDocs)((0,a.collection)(r.db,"paymentTerms"))).docs.map(e=>{let t,s;return t=e.data(),s=e.id,{code:t.code??s,name:t.name??"",category:t.category??"net",status:t.status??"active",description:t.description,netDays:"number"==typeof t.netDays?t.netDays:void 0,monthlyOffset:"number"==typeof t.monthlyOffset?t.monthlyOffset:void 0,sortOrder:"number"==typeof t.sortOrder?t.sortOrder:Number.parseInt(t.sortOrder??"0",10)||0}});e.length&&i(t=>{let s=new Map(t.map(e=>[e.code.toUpperCase(),e]));return e.forEach(e=>s.set(e.code.toUpperCase(),e)),Array.from(s.values())})}catch(e){console.error("Failed to load payment terms",e)}finally{u(!1)}})()},[]),(0,s.useEffect)(()=>{if(!b)return;let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[b]);let D=(0,s.useMemo)(()=>[...e].sort((e,t)=>{let s=e.sortOrder??0,a=t.sortOrder??0;return s!==a?s-a:e.code.localeCompare(t.code)}),[e]),T=(0,s.useMemo)(()=>D.filter(e=>{let t=y.keyword.toLowerCase(),s=!t||[e.code,e.name,e.description].filter(Boolean).join(" ").toLowerCase().includes(t),a="all"===y.category||e.category===y.category,r="all"===y.status||e.status===y.status;return s&&a&&r}),[y,D]),M=()=>{h(!1),j(c()),C(null),g(null)},E=(e,t)=>{j(s=>({...s,[e]:t}))},U=async t=>{if(t.preventDefault(),P)return;let s=v?v.toUpperCase():N.code.trim().toUpperCase(),o=N.name.trim(),l=N.description.trim(),n=""===N.sortOrder.trim()?void 0:Number.parseInt(N.sortOrder,10),d=""===N.netDays.trim()?void 0:Number.parseInt(N.netDays,10),c=""===N.monthlyOffset.trim()?void 0:Number.parseInt(N.monthlyOffset,10);if(!s)return void C("請輸入付款條件代碼");if(!o)return void C("請輸入付款條件名稱");if(Number.isNaN(n??0))return void C("排序請輸入數字");if("net"===N.category&&(void 0===d||Number.isNaN(d)))return void C("貨到 N 天的條件，需要輸入天數");if("monthly"===N.category&&(void 0===c||Number.isNaN(c)))return void C("月結條件需要輸入付款天數，如 30");if(!v&&e.some(e=>e.code.toUpperCase()===s))return void C("此代碼已存在，請勿重複建立。");k(!0),C(null);let m={code:s,name:o,category:N.category,status:N.status,description:l,...void 0!==d?{netDays:d}:{netDays:null},...void 0!==c?{monthlyOffset:c}:{monthlyOffset:null},...void 0!==n?{sortOrder:n}:{sortOrder:null},updatedAt:(0,a.serverTimestamp)(),...v?{}:{createdAt:(0,a.serverTimestamp)()}};try{await (0,a.setDoc)((0,a.doc)(r.db,"paymentTerms",s),m,{merge:!0}),i(e=>{let t=e.filter(e=>e.code.toUpperCase()!==s);return t.push({code:s,name:o,category:N.category,status:N.status,description:l||void 0,netDays:d,monthlyOffset:c,sortOrder:n}),t}),S(v?`已更新 ${s}`:`已新增 ${s}`),M()}catch(e){console.error("Failed to save payment term",e),C("儲存付款條件時發生錯誤，請稍後再試。")}finally{k(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[b&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-lg max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:v?"Edit":"Create"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:v?`編輯付款條件 ${N.code}`:"新增付款條件"})]}),(0,t.jsx)("button",{onClick:M,className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("form",{onSubmit:U,className:"mt-4 space-y-4",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["分類代碼",(0,t.jsx)("input",{type:"text",value:N.code,onChange:e=>E("code",e.target.value.toUpperCase()),readOnly:!!v,maxLength:12,className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm uppercase focus:border-teal-500 focus:outline-none disabled:bg-slate-100",placeholder:"例：NET30"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["名稱",(0,t.jsx)("input",{type:"text",value:N.name,onChange:e=>E("name",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"例：月結 30 天"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["類別",(0,t.jsx)("select",{value:N.category,onChange:e=>E("category",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:l.filter(e=>"all"!==e.value).map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),"net"===N.category&&(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["天數（例：30）",(0,t.jsx)("input",{type:"number",min:0,value:N.netDays,onChange:e=>E("netDays",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),"monthly"===N.category&&(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["付款天數（例：30 = 次月 30 日）",(0,t.jsx)("input",{type:"number",min:0,value:N.monthlyOffset,onChange:e=>E("monthlyOffset",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["狀態",(0,t.jsxs)("select",{value:N.status,onChange:e=>E("status",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"active",children:"使用中"}),(0,t.jsx)("option",{value:"inactive",children:"停用"})]})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["排序",(0,t.jsx)("input",{type:"number",value:N.sortOrder,onChange:e=>E("sortOrder",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["描述（選填）",(0,t.jsx)("textarea",{value:N.description,onChange:e=>E("description",e.target.value),rows:3,className:"mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"補充說明：結帳週期、預付比例、核准流程…"})]}),w&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:w}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:M,className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"取消"}),(0,t.jsx)("button",{type:"submit",disabled:P,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:opacity-50",children:P?"儲存中…":v?"更新條件":"建立條件"})]})]})]})}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Payment Terms"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"付款條件主檔"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"統一管理供應商與單據使用的付款條件文字與邏輯。"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700",children:"匯出設定"}),(0,t.jsx)("button",{onClick:()=>{g(null),C(null),j(c()),h(!0)},className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white",children:"新增付款條件"})]})]}),O&&(0,t.jsx)("p",{className:"mt-4 rounded-xl bg-emerald-50 px-4 py-2 text-sm font-semibold text-emerald-700",children:O})]}),(0,t.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),f(p)},className:"grid gap-4 rounded-2xl bg-slate-50/80 p-4 md:grid-cols-4",children:[(0,t.jsxs)("label",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"搜尋關鍵字"}),(0,t.jsx)("input",{type:"text",value:p.keyword,onChange:e=>x(t=>({...t,keyword:e.target.value})),placeholder:"代碼 / 名稱 / 描述",className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"類型"}),(0,t.jsx)("select",{value:p.category,onChange:e=>x(t=>({...t,category:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:l.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"狀態"}),(0,t.jsx)("select",{value:p.status,onChange:e=>x(t=>({...t,status:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:n.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"flex items-end gap-2 md:col-span-4 md:justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{x(d),f(d)},className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"重置"}),(0,t.jsx)("button",{type:"submit",className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm",children:"套用搜尋"})]})]})}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsx)("p",{className:"text-sm text-slate-500",children:m?"載入中…":`已篩選 ${T.length} 筆條件（共 ${e.length} 筆）`}),(0,t.jsx)("div",{className:"ml-auto flex gap-2 text-xs font-semibold",children:l.filter(e=>"all"!==e.value).map(e=>(0,t.jsx)("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-600",children:e.label},e.value))})]}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto rounded-xl border border-slate-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsx)("tr",{children:["代碼","名稱","類型","描述","狀態","排序","操作"].map(e=>(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:e},e))})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-50",children:T.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-slate-50/70",children:[(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 font-semibold text-slate-900",children:e.code}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-700",children:e.name}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("span",{className:"rounded-full bg-slate-900/10 px-3 py-1 text-xs font-semibold text-slate-700",children:(e=>{switch(e){case"cash":return"現金 / COD";case"net":return"貨到 N 天";case"monthly":return"月結";case"installment":return"預付 / 分期";default:return"其他"}})(e.category)})}),(0,t.jsx)("td",{className:"px-4 py-3 text-slate-500",children:e.description?e.description:"—"}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${"active"===e.status?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:"active"===e.status?"使用中":"停用"})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-500",children:e.sortOrder??"—"}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("button",{onClick:()=>{g(e.code),C(null),j({code:e.code,name:e.name,category:e.category,status:e.status,description:e.description??"",netDays:e.netDays?.toString()??"",monthlyOffset:e.monthlyOffset?.toString()??"",sortOrder:e.sortOrder?.toString()??""}),h(!0)},className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-700 hover:border-teal-500 hover:text-teal-700",children:"編輯"})})]},e.code))})]})})]})]})}e.s(["PaymentTermDirectory",()=>i])}]);