(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47821,e=>{"use strict";e.s(["materialCategories",0,[{code:"MECH",name:"機構零件",type:"part",description:"焊接件、加工件、鈑金、鋼構等機械零件",status:"active",sortOrder:10},{code:"ELEC",name:"電控零件",type:"part",description:"電機、電控相關元件與線材",status:"active",sortOrder:20},{code:"CHEM",name:"藥劑耗材",type:"purchase",description:"藥劑、濾材、耗材等採購品",status:"active",sortOrder:30},{code:"STD",name:"標準件",type:"part",description:"螺絲、束帶、氣壓配件等標準採購件",status:"active",sortOrder:40},{code:"PACK",name:"包材 / 配件",type:"other",description:"包裝材料、工具、組裝配件",status:"active",sortOrder:50}],"materials",0,[{code:"PS-00001",name:"BS3X5 下軸承座",spec:"3X5mm, SS400+鍍鋅",type:"PS",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-MAIN",preferredSupplierCode:"SUP0001",purchaseLeadTimeDays:12,stdCost:4500,currency:"TWD",status:"active",isStocked:!0,note:"標準採購件，適用油水分離機 BS 系列",isVariant:!1},{code:"PM-00001",name:"絞爪 3X5-2 用",spec:"2mm, 客製長 780mm",type:"PM",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-WIP",preferredSupplierCode:"SUP0002",purchaseLeadTimeDays:20,status:"active",isStocked:!1,note:"訂製件，目前僅供案號 2025-BS-021 使用",baseCode:"PM-00001",isVariant:!1},{code:"PO-00001",name:"除油劑 A 配方",spec:"液態 25L/桶",type:"PO",categoryCode:"CHEM",unitCode:"L",defaultWarehouseCode:"WH-MAT",preferredSupplierCode:"SUP0003",purchaseLeadTimeDays:15,stdCost:1800,currency:"TWD",status:"active",isStocked:!0,note:"採購品，需低溫存放",isVariant:!1},{code:"PM-00001-00001",name:"絞爪 3X5-2 客製尺寸 1",spec:"2mm, 客製長 820mm",type:"PM",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-WIP",preferredSupplierCode:"SUP0002",purchaseLeadTimeDays:20,status:"active",isStocked:!1,baseCode:"PM-00001",variantNo:"00001",isVariant:!0,note:"PM-00001 子料，案號 2025-BS-021 變形 A"}],"paymentTerms",0,[{code:"NET30",name:"貨到 30 天內付款",category:"net",netDays:30,status:"active",description:"出貨日 + 30 天付款",sortOrder:10},{code:"MONTH30",name:"月結 30 天",category:"monthly",monthlyOffset:30,status:"active",description:"每月月底結算，次月 30 日付款",sortOrder:20},{code:"COD",name:"貨到付現",category:"cash",status:"active",description:"交貨時付款",sortOrder:30},{code:"PREPAY30_70",name:"預付30%＋尾款70%",category:"installment",status:"active",description:"下單預付30%，出貨前付清剩餘70%",sortOrder:40},{code:"ON_HOLD",name:"暫停付款條款",category:"installment",status:"inactive",description:"僅留存紀錄，不提供新單據使用",sortOrder:90}],"sequences",0,[{key:"QUOTE",prefix:"QU",padding:4,nextNumber:128,scope:"報價"},{key:"ORDER",prefix:"SO",padding:5,nextNumber:3021,scope:"訂單"},{key:"WO",prefix:"WO",padding:5,nextNumber:873,scope:"製令"},{key:"SERIAL",prefix:"CFM",padding:6,nextNumber:54219,scope:"序號"},{key:"USER",prefix:"UA",padding:4,nextNumber:2,scope:"帳號"},{key:"EMPLOYEE",prefix:"JFS",padding:4,nextNumber:16,scope:"員工"},{key:"PART_PS",prefix:"PS-",padding:5,nextNumber:1,scope:"帳號"},{key:"PART_PM",prefix:"PM-",padding:5,nextNumber:1,scope:"帳號"},{key:"PART_PO",prefix:"PO-",padding:5,nextNumber:1,scope:"帳號"},{key:"SUPPLIER",prefix:"SUP",padding:4,nextNumber:4,scope:"帳號"}],"suppliers",0,[{code:"SUP0001",name:"亞鋼金屬",contact:"陳小姐",phone:"02-1234-5678",level:"A",leadTimeDays:12,status:"active",email:"sales@acm.com.tw",address:"台中市大肚區工業路 100 號",paymentTermCode:"MONTH30",taxId:"12345678",note:"主要供應 SS 板材"},{code:"SUP0002",name:"鑫泉幫浦",contact:"吳經理",phone:"04-8765-4321",level:"A",leadTimeDays:20,status:"active",email:"service@pump.com.tw",paymentTermCode:"NET30"},{code:"SUP0003",name:"沛富化工原料",contact:"林先生",phone:"07-2222-8888",level:"B",leadTimeDays:15,status:"suspended",note:"僅供偶爾訂單使用"}],"units",0,[{code:"EA",name:"台",category:"count",conversion:"1 台 = 1 件"},{code:"SET",name:"套",category:"count",conversion:"1 套 = 多件零組"},{code:"BAR",name:"條",category:"count",conversion:"1 條 = 1 件"},{code:"KG",name:"公斤",category:"weight",conversion:"1 kg = 1000 g"},{code:"L",name:"公升",category:"volume",conversion:"1 L = 1000 mL"},{code:"MM",name:"毫米",category:"length",conversion:"1 mm = 0.001 m"},{code:"LPM",name:"公升/分鐘",category:"flow",conversion:"1 LPM = 0.001 m³/min"},{code:"M3H",name:"立方米/小時",category:"flow",conversion:"1 m³/h = 16.67 LPM"},{code:"DEG-C",name:"攝氏度",category:"temperature",conversion:"基準溫標 °C"},{code:"DEG-F",name:"華氏度",category:"temperature",conversion:"°F = °C × 1.8 + 32"}],"warehouses",0,[{code:"WH-MAIN",name:"主倉",type:"raw",status:"active",isDefaultReceive:!0,isDefaultIssue:!0,sortOrder:10,address:"台中大肚廠內一樓",note:"零件材料主要存放區"},{code:"WH-MAT",name:"材料倉",type:"raw",status:"active",sortOrder:20,address:"台中大肚廠內二樓",note:"板金 / 型材 / 標準件"},{code:"WH-FG",name:"成品倉",type:"fg",status:"active",sortOrder:30,address:"台中大肚廠外成品棚"},{code:"WH-WIP",name:"組裝暫存區",type:"wip",status:"active",sortOrder:40,note:"組裝工位旁暫存架"},{code:"WH-OUT-TC",name:"外包倉-台中",type:"other",status:"active",sortOrder:50,note:"外包加工廠暫存"}]])},84616,43873,78598,e=>{"use strict";var t=e.i(71645);e.s(["DEPARTMENT_DEFINITIONS",0,{executive:{label:"經營",description:"決策／策略"},rd:{label:"研發",description:"產品與設計"},production:{label:"生產",description:"製造與現場"},sales:{label:"營銷",description:"業務與客服"},management:{label:"管理",description:"行政／管理"},finance:{label:"財務",description:"財會／稽核"}},"ROLE_DEFINITIONS",0,{admin:{label:"Admin",description:"序號調整、審核、最高權限",hierarchy:4},manager:{label:"Manager",description:"日常維運與審核啟動",hierarchy:3},planner:{label:"Planner",description:"草稿建立、流程規劃",hierarchy:2},operator:{label:"Operator",description:"查詢與執行現場作業",hierarchy:1}}],43873);let s={users:{label:"使用者",description:"帳號與權限"},employees:{label:"員工",description:"人事資料卡"},units:{label:"計量單位",description:"跨模組基本單位"},suppliers:{label:"供應商",description:"採購夥伴"},customers:{label:"客戶",description:"營銷對象"},parts:{label:"零件",description:"料號與成本"},products:{label:"產品",description:"BOM 與模組"},categories:{label:"類別",description:"物料分類"},files:{label:"檔案中心",description:"設計圖 / 圖片 / 附件"},sequences:{label:"序號",description:"Prefix / 流水"},quotes:{label:"報價",description:"報價單與交期"},orders:{label:"訂單",description:"接單與變更"},inventory:{label:"庫存",description:"入出庫與盤點"},production:{label:"產品/製令",description:"工單與製造履歷"},materials:{label:"物料",description:"零件與採購料主檔"}},a={view:"檢視",create:"新增",update:"編輯",disable:"停用",approve:"核准",lock:"鎖定","sequence-adjust":"調整序號",cancel:"作廢"},r={admin:{users:["view","create","update","disable","approve"],employees:["view","create","update","disable"],units:["view","create","update","disable","approve"],suppliers:["view","create","update","disable","approve"],customers:["view","create","update","disable","approve"],parts:["view","create","update","disable","approve"],products:["view","create","update","disable","approve"],categories:["view","create","update","disable","approve"],sequences:["view","lock","sequence-adjust","approve"],quotes:["view","create","update","approve","lock","cancel"],orders:["view","create","update","approve","lock","cancel"],inventory:["view","create","update","lock"],production:["view","create","update","approve","lock"],materials:["view","create","update","disable"],files:["view","create","update","disable"]},manager:{users:["view","create","update","disable"],employees:["view","create","update"],units:["view","create","update","disable"],suppliers:["view","create","update"],customers:["view","create","update"],parts:["view","create","update","disable"],products:["view","create","update"],categories:["view","create","update"],sequences:["view","lock"],quotes:["view","create","update","lock"],orders:["view","create","update","lock"],inventory:["view","create","update"],production:["view","create","update"],materials:["view","create","update"],files:["view","create","update"]},planner:{users:["view"],employees:["view","create"],units:["view","create"],suppliers:["view","create"],customers:["view","create"],parts:["view","create"],products:["view","create"],categories:["view","create"],sequences:["view"],quotes:["view","create"],orders:["view","create"],inventory:["view","create"],production:["view","create"],materials:["view","create"],files:["view","create"]},operator:{users:["view"],employees:["view"],units:["view"],suppliers:["view"],customers:["view"],parts:["view"],products:["view"],categories:["view"],sequences:["view"],quotes:["view"],orders:["view"],inventory:["view"],production:["view"],materials:["view"],files:["view"]}};function l(e,t){let s={users:[],employees:[],units:[],suppliers:[],customers:[],parts:[],products:[],categories:[],materials:[],files:[],sequences:[],quotes:[],orders:[],inventory:[],production:[]},{roleFilter:a,departmentFilter:l}=t??{},i=e.filter(e=>{let t=!a||e.role===a,s=!l||!e.departments.length||e.departments.includes(l);return t&&s});if(!i.length)return s;for(let e of i)Object.entries(r[e.role]).forEach(([e,t])=>{let a=new Set(s[e]);t.forEach(e=>a.add(e)),s[e]=Array.from(a)});return s}function i(e,t,s,a){let r=l(e,a);return r[t]?.includes(s)??!1}e.s(["ACTION_LABELS",()=>a,"MODULE_DEFINITIONS",()=>s,"buildPermissionProfile",()=>l,"canPerformAction",()=>i],78598);var o=e.i(57951);function n(e){let{assignments:s,roleFilter:a,departmentFilter:r}=e??{},{claims:n}=(0,o.useAuth)(),d=!!(s&&s.length),c=(0,t.useMemo)(()=>{if(!n?.roles?.length)return[];let e=n.departments??[];return n.roles.map(t=>({role:t,departments:e}))},[n?.departments,n?.roles]),u=(0,t.useMemo)(()=>{if(d&&s)return l(s,{roleFilter:a,departmentFilter:r});let e=n?.modules;if(e){let t=l(c,{roleFilter:a,departmentFilter:r});return Object.keys(t).forEach(s=>{let a=e[s];Array.isArray(a)&&(t[s]=a)}),t}return c.length?l(c,{roleFilter:a,departmentFilter:r}):null},[s,n?.modules,r,c,a,d]);return{profile:u,can:(e,t)=>{if(d&&s)return i(s,e,t,{roleFilter:a,departmentFilter:r});let l=u?.[e];return!!Array.isArray(l)&&l.includes(t)}}}e.s(["usePermission",()=>n],84616)},27379,e=>{"use strict";e.i(36180);var t=e.i(98925),s=e.i(74503);let a=new Map(e.i(47821).sequences.map(e=>[e.key,{...e}])),r=(0,t.collection)(s.db,"sequences");async function l(e){let l=a.get(e);if(!l)throw Error(`Sequence ${e} not found`);let i=await (0,t.runTransaction)(s.db,async s=>{let a=(0,t.doc)(r,e),i=await s.get(a),o={prefix:l.prefix,padding:l.padding,nextNumber:l.nextNumber};i.exists()&&(o=i.data());let n=`${o.prefix}${o.nextNumber.toString().padStart(o.padding,"0")}`;return s.set(a,{prefix:o.prefix,padding:o.padding,nextNumber:o.nextNumber+1},{merge:!0}),{value:n,issuedNumber:o.nextNumber}});return l.nextNumber=i.issuedNumber+1,{key:e,value:i.value,issuedNumber:i.issuedNumber}}e.s(["issueSequence",()=>l])},5267,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(36180);var a=e.i(98925),r=e.i(27379),l=e.i(78598),i=e.i(43873),o=e.i(84616),n=e.i(74503),d=e.i(57951);let c=[{label:"全部角色",value:"all"},...Object.entries(i.ROLE_DEFINITIONS).map(([e,t])=>({label:t.label,value:e}))],u=[{label:"全部狀態",value:"all"},{label:"啟用",value:"active"},{label:"停用",value:"inactive"}],p=c.filter(e=>"all"!==e.value),m=Object.entries(i.DEPARTMENT_DEFINITIONS).map(([e,t])=>({label:t.label,value:e})),x=["suppliers","quotes","orders","inventory","production","sequences"],v={suppliers:["view","create","update","disable","approve"],quotes:["view","create","update","lock","approve","cancel"],orders:["view","create","update","lock","approve","cancel"],inventory:["view","create","update","lock"],production:["view","create","update","lock","approve"],sequences:["view","lock","sequence-adjust"]},b=["view","create","update"],h=()=>({name:"",email:"",primaryRole:p[0]?.value??"manager",departments:["management"],status:"active",moduleOverrides:{}}),f={keyword:"",role:"all",status:"all"};function y(){let{user:e,claims:y}=(0,d.useAuth)(),[g,N]=(0,s.useState)([]),[w,j]=(0,s.useState)([]),[S,E]=(0,s.useState)(!0),[O,C]=(0,s.useState)(null),[P,T]=(0,s.useState)(f),[I,M]=(0,s.useState)(f),[k,A]=(0,s.useState)(!1),[D,L]=(0,s.useState)(()=>h()),[R,q]=(0,s.useState)(null),[F,U]=(0,s.useState)(null),[$,_]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(k){let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}}},[k]),(0,s.useEffect)(()=>{(async()=>{try{let e=(await (0,a.getDocs)((0,a.collection)(n.db,"users"))).docs.map(e=>{let t=e.data(),s=t.roles??[],a=t.primaryRole??s.find(e=>e.isPrimary)?.role??"manager",r=t.departments??[];return{id:t.id??e.id,name:t.name??"",email:t.email??"",primaryRole:a,roles:s,departments:r,status:t.status??"active",moduleOverrides:t.overrides,lastLoginAt:t.lastLoginAt}});N(e)}catch(e){console.error("Failed to load users from Firestore",e),C("讀取雲端使用者資料失敗，請稍後再試。")}finally{E(!1)}})()},[]),(0,s.useEffect)(()=>{j(g.reduce((t,s)=>{let a=s.email?.toLowerCase();if(!a)return t;let r=t.findIndex(e=>e.email?.toLowerCase()===a);return -1===r?t.push(s):s.id===e?.uid&&(t[r]=s),t},[]))},[e?.uid,g]);let H=(0,s.useMemo)(()=>{let t=e?.email?.toLowerCase();if(t)return w.find(e=>e.email.toLowerCase()===t)},[e,w]),W=(0,s.useMemo)(()=>H?.roles??[],[H]),[B,V]=(0,s.useState)(),[G,K]=(0,s.useState)("all");(0,s.useEffect)(()=>{W.length?V(e=>e??W[0]?.role):V(void 0),K("all")},[W]);let X=(0,s.useMemo)(()=>{if(!B||!W.length)return["all"];let e=new Set;return W.filter(e=>e.role===B).forEach(t=>t.departments.forEach(t=>e.add(t))),["all",...Array.from(e)]},[B,W]),Y=X.includes(G)?G:"all",{profile:Q,can:z}=(0,o.usePermission)({assignments:W,roleFilter:B,departmentFilter:"all"===Y?void 0:Y}),{can:J}=(0,o.usePermission)(),Z=!!y,ee=(0,s.useMemo)(()=>Q?Object.entries(Q).filter(([,e])=>e.length>0):[],[Q]),et=J("users","create"),es=(0,s.useMemo)(()=>w.filter(e=>{let t=e.departments.map(e=>i.DEPARTMENT_DEFINITIONS[e]?.label??e).join(" "),s=e.roles.map(e=>i.ROLE_DEFINITIONS[e.role].label).join(" "),a=[e.name,e.id,e.email,t,s].join(" ").toLowerCase(),r=!I.keyword||a.includes(I.keyword.toLowerCase()),l="all"===I.role||e.roles.some(e=>e.role===I.role),o="all"===I.status||e.status===I.status;return r&&l&&o}),[I,w]),ea=async e=>{if(e.preventDefault(),$)return;if(!H||!et)return void q("目前帳號沒有新增使用者權限");if(!D.name.trim())return void q("請輸入姓名");if(!D.email.trim())return void q("請輸入 Email");if(!D.departments.length)return void q("至少勾選一個部門");let t=D.email.trim().toLowerCase();if(g.some(e=>e.email.toLowerCase()===t))return void q("此 Email 已存在，請勿重複建立相同使用者。");_(!0),U(null);let s="";try{s=(await (0,r.issueSequence)("USER")).value}catch{_(!1),q("取得序號時發生問題，請稍後再試");return}let l=Object.entries(D.moduleOverrides).filter(([,e])=>e&&e.length>0),i=l.length?Object.fromEntries(l):void 0,o={id:s,name:D.name.trim(),primaryRole:D.primaryRole,roles:[{role:D.primaryRole,departments:D.departments,isPrimary:!0}],departments:D.departments,email:D.email.trim(),status:D.status,...i?{moduleOverrides:i}:{}},d=n.auth.currentUser;if(!d){_(!1),q("登入狀態失效，請重新登入後再試。");return}try{let e={id:o.id,name:o.name,email:o.email,primaryRole:o.primaryRole,status:o.status,roles:o.roles,departments:o.departments};i&&(e.overrides=i),await (0,a.addDoc)((0,a.collection)(n.db,"userProvisioning"),{requestedByUid:d.uid,requestedBy:d.email?.toLowerCase()??"",payload:e,state:"pending",createdAt:(0,a.serverTimestamp)()}),N(e=>[...e,o]),A(!1),L(h()),q(null),U(`已送出建立請求，預設密碼為 12345678，完成後即可登入。`),T(f),M(f)}catch(e){console.error("Failed to enqueue managed user",e),q("寫入建立請求時發生錯誤，請稍後再試。")}finally{_(!1)}},er=()=>{A(!1),L(h()),q(null),U(null)};return(0,t.jsxs)(t.Fragment,{children:[k&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-xl overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl max-h-[90vh]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Create"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"新增使用者"})]}),(0,t.jsx)("button",{onClick:er,className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("form",{onSubmit:ea,className:"mt-4 space-y-4",children:[(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-slate-600",children:"姓名"}),(0,t.jsx)("input",{type:"text",value:D.name,onChange:e=>L(t=>({...t,name:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block",children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-slate-600",children:"Email"}),(0,t.jsx)("input",{type:"email",value:D.email,onChange:e=>L(t=>({...t,email:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"}),(0,t.jsx)("p",{className:"mt-1 text-[11px] text-slate-400",children:"系統會自動建立 Authentication 帳號並同步權限，無須手動處理 UID。"})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-slate-600",children:"主要角色"}),(0,t.jsx)("select",{value:D.primaryRole,onChange:e=>L(t=>({...t,primaryRole:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:p.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-slate-600",children:"狀態"}),(0,t.jsx)("select",{value:D.status,onChange:e=>L(t=>({...t,status:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:u.filter(e=>"all"!==e.value).map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-slate-600",children:"部門授權"}),(0,t.jsx)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:m.map(e=>{let s=D.departments.includes(e.value);return(0,t.jsxs)("label",{className:"flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:s,onChange:()=>{var t;return t=e.value,void L(e=>{let s=e.departments.includes(t);return{...e,departments:s?e.departments.filter(e=>e!==t):[...e.departments,t]}})},className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),(0,t.jsx)("span",{children:e.label})]},e.value)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-xs font-semibold text-slate-600",children:"模組權限覆寫（選填）"}),(0,t.jsx)("p",{className:"text-[11px] text-slate-400",children:"預設沿用角色矩陣，僅在需額外授權時勾選具體動作。"}),(0,t.jsx)("div",{className:"mt-2 max-h-56 space-y-3 overflow-y-auto pr-1",children:x.map(e=>{let s=v[e]??b,a=D.moduleOverrides[e]??[];return(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 p-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-slate-900",children:[(0,t.jsx)("span",{children:l.MODULE_DEFINITIONS[e].label}),a.length>0&&(0,t.jsxs)("span",{className:"text-xs text-teal-600",children:[a.length," 項"]})]}),(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:s.map(s=>{let r=a.includes(s);return(0,t.jsx)("button",{type:"button",onClick:()=>{L(t=>{let a=t.moduleOverrides[e]??[],r=a.includes(s)?a.filter(e=>e!==s):[...a,s],l={...t.moduleOverrides};return 0===r.length?delete l[e]:l[e]=r,{...t,moduleOverrides:l}})},className:`rounded-full border px-3 py-1 text-xs font-semibold transition ${r?"border-teal-500 bg-teal-50 text-teal-700":"border-slate-200 text-slate-500"}`,children:l.ACTION_LABELS[s]},`${e}-${s}`)})})]},e)})})]}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"儲存後系統將透過序號模組自動產生帳號代碼，並寫入審計軌跡。"}),R&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:R}),F&&(0,t.jsx)("p",{className:"text-sm font-semibold text-emerald-600",children:F}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:er,className:"rounded-full border border-slate-300 px-5 py-2 text-sm font-semibold text-slate-600",children:"取消"}),(0,t.jsx)("button",{type:"submit",disabled:$,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:cursor-not-allowed disabled:bg-slate-400",children:$?"建立中…":"建立使用者"})]})]})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.25em] text-teal-600",children:"Users"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"組織帳號管理"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"與 BOM、庫存模組共用權限，確保操作軌跡可追蹤。"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{onClick:()=>{et&&alert("匯入 CSV 功能尚未開放，之後會在這裡提供。")},className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 disabled:opacity-40",disabled:!et||!Z,children:"匯入 CSV"}),(0,t.jsx)("button",{onClick:()=>{et&&(q(null),U(null),A(!0))},disabled:!et||!Z,className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white disabled:bg-slate-400",children:"新增使用者"})]})]}),H&&B&&(0,t.jsxs)("div",{className:"mt-6 grid gap-4 rounded-2xl border border-slate-100 bg-slate-900/5 p-4 text-sm text-slate-700 md:grid-cols-4",children:[(0,t.jsxs)("label",{children:[(0,t.jsxs)("p",{className:"text-xs font-semibold text-slate-600",children:["操作視角（目前：",H.name,"）"]}),(0,t.jsx)("select",{value:B,onChange:e=>{V(e.target.value),K("all")},className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:W.map(e=>(0,t.jsx)("option",{value:e.role,children:i.ROLE_DEFINITIONS[e.role].label},`${e.role}-${e.departments.join("-")}`))})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"部門範圍"}),(0,t.jsx)("select",{value:Y,onChange:e=>K(e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:X.map(e=>(0,t.jsx)("option",{value:e,children:"all"===e?"全部部門":i.DEPARTMENT_DEFINITIONS[e]?.label??e},e))})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"權限摘要"}),(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:ee.length?ee.map(([e,s])=>(0,t.jsxs)("span",{className:"rounded-full bg-slate-900/10 px-3 py-1 text-xs font-semibold text-slate-700",children:[l.MODULE_DEFINITIONS[e].label,"：",s.map(e=>l.ACTION_LABELS[e]).join("/")]},e)):(0,t.jsx)("span",{className:"text-xs text-slate-400",children:"尚未為此視角授權"})})]})]}),!H&&!S&&(0,t.jsx)("p",{className:"mt-4 text-xs text-red-600",children:"目前登入帳號尚未在「使用者主檔」建立資料，暫時僅能瀏覽，無法操作權限相關功能。"}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),M(P)},className:"mt-6 grid gap-4 rounded-2xl bg-slate-50/80 p-4 md:grid-cols-4",children:[(0,t.jsxs)("label",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"搜尋關鍵字"}),(0,t.jsx)("input",{type:"text",value:P.keyword,onChange:e=>T(t=>({...t,keyword:e.target.value})),placeholder:"姓名 / 部門 / Email / 員工代碼",className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"角色"}),(0,t.jsx)("select",{value:P.role,onChange:e=>T(t=>({...t,role:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:c.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"狀態"}),(0,t.jsx)("select",{value:P.status,onChange:e=>T(t=>({...t,status:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:u.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"flex items-end gap-2 md:col-span-4 md:justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{T(f),M(f)},className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"重置"}),(0,t.jsx)("button",{type:"submit",className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm",children:"套用搜尋"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsx)("p",{className:"text-sm text-slate-500",children:S?"載入中…":`已篩選 ${es.length} 位使用者（共 ${g.length} 位）`}),(0,t.jsx)("div",{className:"ml-auto flex gap-2 text-xs font-semibold",children:c.filter(e=>"all"!==e.value).map(e=>(0,t.jsx)("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-600",children:e.label},e.value))})]}),O&&(0,t.jsx)("p",{className:"mt-3 text-xs font-semibold text-red-600",children:O}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto rounded-xl border border-slate-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsx)("tr",{children:["姓名","角色/部門","Email","狀態","最後登入"].map(e=>(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:e},e))})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-50",children:es.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-slate-50/70",children:[(0,t.jsxs)("td",{className:"whitespace-nowrap px-4 py-3",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:e.id})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:e.roles.map(s=>(0,t.jsxs)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${s.isPrimary?"bg-teal-50 text-teal-700":"bg-slate-100 text-slate-600"}`,children:[i.ROLE_DEFINITIONS[s.role].label,s.departments.length?` \xb7 ${s.departments.map(e=>i.DEPARTMENT_DEFINITIONS[e]?.label??e).join("/")}`:""]},`${e.id}-${s.role}-${s.departments.join("-")}`))})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-600",children:e.email}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${"active"===e.status?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:"active"===e.status?"使用中":"停用"})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-xs text-slate-500",children:(e=>{if(!e)return"—";let t=new Date(e);if(Number.isNaN(t.getTime()))return e;let s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${s}/${a}/${r} ${l}:${i}`})(e.lastLoginAt)})]},e.id))})]})})]})]})]})}e.s(["UserDirectory",()=>y])}]);