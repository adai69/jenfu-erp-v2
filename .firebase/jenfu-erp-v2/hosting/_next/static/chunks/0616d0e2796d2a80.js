(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,19494,e=>{"use strict";var t=e.i(43476),s=e.i(22016),l=e.i(71645);e.i(36180);var a=e.i(98925);e.i(61086);var d=e.i(27215),r=e.i(74503),o=e.i(9348),i=e.i(47821),n=e.i(27379),c=e.i(84616);let x={keyword:"",type:"all",category:"all",status:"all"},m=(e,t)=>({code:"",name:"",spec:"",type:"PS",categoryCode:e??i.materialCategories[0]?.code??"",unitCode:i.units[0]?.code??"",defaultWarehouseCode:"",preferredSupplierCode:"",purchaseLeadTimeDays:"",stdCost:"",currency:"TWD",status:"active",isStocked:!0,note:"",baseCode:t,isVariant:!!t}),u=[{label:"標準 (PS)",value:"PS"},{label:"訂製 (PM)",value:"PM"},{label:"其他 (PO)",value:"PO"}];function p(){let e,p,[h,b]=(0,l.useState)(i.materials),[f,j]=(0,l.useState)(i.materialCategories),[y,N]=(0,l.useState)(i.units),[v,g]=(0,l.useState)(i.warehouses),[C,w]=(0,l.useState)(i.suppliers),[S,k]=(0,l.useState)(x),[P,T]=(0,l.useState)(x),[D,L]=(0,l.useState)(!1),[W,U]=(0,l.useState)(!1),[A,M]=(0,l.useState)(null),[V,R]=(0,l.useState)(()=>m(i.materialCategories[0]?.code)),[$,I]=(0,l.useState)(!1),[z,B]=(0,l.useState)(null),[E,F]=(0,l.useState)(null),[O,K]=(0,l.useState)(!1),[_,q]=(0,l.useState)(null),[G,H]=(0,l.useState)([]),[J,Q]=(0,l.useState)(!1),[X,Y]=(0,l.useState)(0),[Z,ee]=(0,l.useState)(!1),[et,es]=(0,l.useState)({title:"",description:"",tags:"",isPrimary:!1}),[el,ea]=(0,l.useState)(null),[ed,er]=(0,l.useState)(null),[eo,ei]=(0,l.useState)(null),[en,ec]=(0,l.useState)(!1),[ex,em]=(0,l.useState)(null),{can:eu}=(0,c.usePermission)(),ep=eu("materials","view"),eh=eu("materials","create"),eb=eu("materials","update"),ef=eu("files","view"),ej=eu("files","create");(0,l.useEffect)(()=>{(async()=>{try{let[e,t,s,l]=await Promise.all([(0,a.getDocs)((0,a.collection)(r.db,"materialCategories")),(0,a.getDocs)((0,a.collection)(r.db,"units")),(0,a.getDocs)((0,a.collection)(r.db,"warehouses")),(0,a.getDocs)((0,a.collection)(r.db,"suppliers"))]),d=e.docs.length>0?e.docs.map(e=>{let t=e.data();return{...t,code:t.code??e.id}}):i.materialCategories;j(d);let o=t.docs.length>0?t.docs.map(e=>({...e.data()})):i.units;N(o);let n=s.docs.length>0?s.docs.map(e=>({...e.data()})):i.warehouses;g(n);let c=l.docs.length>0?l.docs.map(e=>({...e.data()})):i.suppliers;w(c)}catch(e){console.error("Failed to load reference data for materials",e)}})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=(await (0,a.getDocs)((0,a.collection)(r.db,"materials"))).docs.map(e=>{let t,s;return t=e.data(),s=e.id,{code:t.code??s,name:t.name??"",spec:t.spec,type:t.type??"PS",categoryCode:t.categoryCode??"",unitCode:t.unitCode??"",defaultWarehouseCode:t.defaultWarehouseCode,preferredSupplierCode:t.preferredSupplierCode,purchaseLeadTimeDays:"number"==typeof t.purchaseLeadTimeDays?t.purchaseLeadTimeDays:void 0,stdCost:"number"==typeof t.stdCost?t.stdCost:void 0,currency:t.currency,status:t.status??"active",isStocked:!!t.isStocked,note:t.note,baseCode:t.baseCode,variantNo:t.variantNo,isVariant:!0===t.isVariant||!!t.variantNo}});e.length&&b(t=>{let s=new Map(t.map(e=>[e.code,e]));return e.forEach(e=>s.set(e.code,e)),Array.from(s.values())})}catch(e){console.error("Failed to load materials",e)}})()},[]),(0,l.useEffect)(()=>{if(!D&&!W)return;let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[D,W]),(0,l.useEffect)(()=>{if(!W||!_||!ef)return void H([]);let e=!0;return(async()=>{Q(!0);try{let t=(0,a.query)((0,a.collection)(r.db,"files"),(0,a.where)("targetModule","==","materials"),(0,a.where)("entityId","==",_.code)),s=await (0,a.getDocs)(t),l=[];for(let e of s.docs){let t=e.data();if(t.deletedAt)continue;let s="string"==typeof t.mimeType?t.mimeType:"application/octet-stream",a={id:e.id,targetModule:"materials",entityId:t.entityId??_.code,storagePath:t.storagePath??"",fileName:t.fileName??e.id,mimeType:s,size:"number"==typeof t.size?t.size:void 0,title:t.title??void 0,description:t.description??void 0,tags:Array.isArray(t.tags)?t.tags:[],isPrimary:!0===t.isPrimary,orderIndex:"number"==typeof t.orderIndex?t.orderIndex:void 0,createdAt:t.createdAt,createdByUid:t.createdByUid??void 0,createdByName:t.createdByName??void 0,deletedAt:void 0};if(a.storagePath&&s.startsWith("image/"))try{a.downloadURL=await (0,d.getDownloadURL)((0,d.ref)(r.storage,a.storagePath))}catch(e){console.warn("Failed to load material preview",e)}l.push(a)}l.sort((e,t)=>{if(e.isPrimary!==t.isPrimary)return e.isPrimary?-1:1;let s=e.orderIndex??e.createdAt?.toDate().getTime()??0;return(t.orderIndex??t.createdAt?.toDate().getTime()??0)-s}),e&&H(l)}catch(t){console.error("Failed to load material files",t),e&&H([])}finally{e&&Q(!1)}})(),()=>{e=!1}},[W,_,ef,X]);let ey=(0,l.useMemo)(()=>h.filter(e=>{let t=P.keyword.trim().toLowerCase(),s=!t||[e.code,e.name,e.spec??""].join(" ").toLowerCase().includes(t),l="all"===P.type||e.type===P.type,a="all"===P.category||e.categoryCode===P.category,d="all"===P.status||e.status===P.status;return s&&l&&a&&d}),[P,h]),eN=async e=>{let t=h.filter(t=>(t.baseCode??t.code)===e&&t.variantNo).map(e=>Number.parseInt(e.variantNo??"0",10)).filter(e=>!Number.isNaN(e)),s=(t.length?Math.max(...t)+1:1).toString().padStart(5,"0"),l=`${e}-${s}`;h.find(e=>e.code===l)?B("生成的子料號已存在，請稍後再試或手動調整。"):R(t=>({...t,code:l,baseCode:e,isVariant:!0,variantNo:s}))},ev=()=>{L(!1),R(m(f[0]?.code)),B(null),M(null),K(!1),ee(!1),ea(null),er(null),ei(null)},eg=async e=>{if(e.preventDefault(),!A)return void er("請先儲存此物料後再上傳檔案。");if(!el||0===el.length)return void er("請選擇至少一個檔案");ec(!0),er(null);try{await (0,o.uploadFilesForEntity)({module:"materials",entityId:A,files:Array.from(el),metadata:{title:et.title,description:et.description,tags:et.tags.split(/[,\s]+/).map(e=>e.trim()).filter(Boolean),setPrimary:et.isPrimary},createdBy:{uid:r.auth.currentUser?.uid??null,name:r.auth.currentUser?.email??r.auth.currentUser?.displayName??"system"}}),ei("已完成檔案上傳"),ea(null),es(e=>({...e,isPrimary:!1})),Y(e=>e+1)}catch(e){console.error("Failed to upload material files",e),er("上傳失敗，請稍後再試。")}finally{ec(!1)}},eC=()=>{ee(!1),ea(null),er(null),ei(null)},ew=(e,t)=>{R(s=>({...s,[e]:t}))},eS=async e=>{if(!A&&!O&&!V.isVariant)try{let t=await (0,n.issueSequence)("PS"===e?"PART_PS":"PM"===e?"PART_PM":"PART_PO");R(e=>({...e,code:t.value}))}catch{B("取得料號時發生問題，請稍後再試。")}},ek=async e=>{R(t=>({...t,type:e})),O||A||await eS(e)},eP=!A&&"PS"===V.type,eT=async e=>{K(e),e?R(e=>({...e,code:"PS-0000A"})):await eS(V.type)},eD=async e=>{if(e.preventDefault(),$)return;let t=V.name.trim(),s=V.code.trim();if(!s)return void B("料號取得失敗，請重新選擇型態或重新整理頁面。");if(!t)return void B("請輸入品名");if(!V.categoryCode)return void B("請選擇物料分類");if(!V.unitCode)return void B("請選擇計量單位");let l=""===V.purchaseLeadTimeDays.trim()?void 0:Number.parseInt(V.purchaseLeadTimeDays,10);if(void 0!==l&&Number.isNaN(l))return void B("採購前置天數需為數字");let d=""===V.stdCost.trim()?void 0:Number.parseFloat(V.stdCost);if(void 0!==d&&Number.isNaN(d))return void B("參考成本需為數字");I(!0),B(null);let o={code:s,name:t,spec:V.spec.trim(),type:V.type,categoryCode:V.categoryCode,unitCode:V.unitCode,defaultWarehouseCode:V.defaultWarehouseCode||null,preferredSupplierCode:V.preferredSupplierCode||null,purchaseLeadTimeDays:l??null,stdCost:d??null,currency:V.currency.trim()||"TWD",status:V.status,isStocked:V.isStocked,note:V.note.trim(),baseCode:V.isVariant&&V.baseCode?V.baseCode:V.isVariant?s.split("-")[0]:null,variantNo:V.isVariant&&s.includes("-")?s.split("-").pop():null,isVariant:V.isVariant??!1,updatedAt:(0,a.serverTimestamp)(),...A?{}:{createdAt:(0,a.serverTimestamp)()}};try{await (0,a.setDoc)((0,a.doc)(r.db,"materials",s),o,{merge:!0}),b(e=>{let a=e.filter(e=>e.code!==s);return a.push({code:s,name:t,spec:V.spec.trim()||void 0,type:V.type,categoryCode:V.categoryCode,unitCode:V.unitCode,defaultWarehouseCode:V.defaultWarehouseCode||void 0,preferredSupplierCode:V.preferredSupplierCode||void 0,purchaseLeadTimeDays:l,stdCost:d,currency:o.currency,status:V.status,isStocked:V.isStocked,note:V.note.trim()||void 0,baseCode:o.baseCode??void 0,variantNo:o.variantNo??void 0,isVariant:o.isVariant??!1}),a}),F(A?`已更新 ${s}`:`已新增 ${s}`),ev()}catch(e){console.error("Failed to save material",e),B("儲存物料時發生錯誤，請稍後再試。")}finally{I(!1)}},eL=e=>f.find(t=>t.code===e)?.name??e,eW=e=>y.find(t=>t.code===e)?.name??e,eU=e=>e?v.find(t=>t.code===e)?.name??e:"—",eA=G.find(e=>e.isPrimary),eM=G.filter(e=>!e.isPrimary);return(0,t.jsxs)("div",{className:"space-y-6",children:[W&&_&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"View"}),(0,t.jsxs)("h2",{className:"text-xl font-semibold text-slate-900",children:["檢視物料 ",_.code]})]}),(0,t.jsx)("button",{onClick:()=>{U(!1),q(null),H([])},className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"基本資料"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"料號"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:_.code})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"物料型態"}),(0,t.jsx)("p",{className:"mt-1 inline-flex items-center rounded-full bg-slate-900/5 px-3 py-1 text-xs font-semibold text-slate-700",children:(e=_.type,u.find(t=>t.value===e)?.label??e)})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"品名"}),(0,t.jsx)("p",{className:"mt-1 text-base font-semibold text-slate-900",children:_.name})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"規格"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-700",children:_.spec?.trim()||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"狀態"}),(0,t.jsx)("span",{className:`mt-1 inline-flex rounded-full px-3 py-1 text-xs font-semibold ${"active"===_.status?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:"active"===_.status?"使用中":"停用"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"庫存管控"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:_.isStocked?"納入":"不納入"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"分類與供應"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"分類"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:eL(_.categoryCode)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"計量單位"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:eW(_.unitCode)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"預設倉庫"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:eU(_.defaultWarehouseCode)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"首選供應商"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:(p=_.preferredSupplierCode)?C.find(e=>e.code===p)?.name??p:"—"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"採購資訊"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"採購前置天數"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:_.purchaseLeadTimeDays??"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"參考成本"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:void 0!==_.stdCost?`${_.currency??"TWD"} ${_.stdCost}`:"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"備註"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-700",children:_.note?.trim()||"—"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"子料資訊"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"是否為子料"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:_.isVariant?"是":"否"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"母料號"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:_.baseCode??"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"子料編號"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:_.variantNo??"—"})]})]})]}),ef&&(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"檔案 / 圖片"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"與此料號關聯的附件與照片"})]}),(0,t.jsx)(s.default,{href:`/master/files?module=materials&entityId=${encodeURIComponent(_.code)}`,className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-700 transition hover:border-teal-500 hover:text-teal-600",children:"開啟檔案中心"})]}),J?(0,t.jsx)("p",{className:"mt-3 text-sm text-slate-500",children:"檔案載入中…"}):G.length?(0,t.jsxs)("div",{className:"mt-4 space-y-4",children:[eA&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"主照片"}),eA.downloadURL?(0,t.jsx)("button",{type:"button",onClick:()=>em(eA),className:"mt-2 block",children:(0,t.jsx)("img",{src:eA.downloadURL,alt:eA.fileName,className:"max-h-64 w-full rounded-2xl object-contain cursor-zoom-in shadow-sm transition hover:shadow-lg"})}):(0,t.jsx)("div",{className:"mt-2 flex h-48 items-center justify-center rounded-2xl bg-slate-50 text-sm text-slate-500",children:"無法預覽此檔案"}),(0,t.jsx)("p",{className:"mt-2 text-sm font-semibold text-slate-900",children:eA.title??eA.fileName}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:eA.mimeType})]}),eM.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"其他附件"}),(0,t.jsx)("div",{className:"mt-2 grid gap-3 sm:grid-cols-2",children:eM.map(e=>(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-100 p-3 text-sm text-slate-600",children:[e.downloadURL&&e.mimeType.startsWith("image/")?(0,t.jsx)("button",{type:"button",onClick:()=>em(e),className:"block",children:(0,t.jsx)("img",{src:e.downloadURL,alt:e.fileName,className:"h-40 w-full rounded-xl object-cover cursor-zoom-in shadow-sm transition hover:shadow-lg"})}):(0,t.jsx)("div",{className:"flex h-40 items-center justify-center rounded-xl bg-slate-50 text-xs text-slate-500",children:"無法預覽"}),(0,t.jsx)("p",{className:"mt-2 text-sm font-semibold text-slate-900",children:e.title??e.fileName}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:e.mimeType})]},e.id))})]})]}):(0,t.jsx)("p",{className:"mt-3 text-sm text-slate-500",children:"尚未上傳任何檔案。"})]})]})]})}),ex&&(0,t.jsx)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-slate-900/60 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Preview"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:ex.title??ex.fileName}),(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:[ex.mimeType,ex.size?` \xb7 ${(ex.size/1024).toFixed(1)} KB`:""]})]}),(0,t.jsx)("button",{type:"button",onClick:()=>em(null),className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsx)("div",{className:"mt-4 rounded-2xl border border-slate-100 bg-slate-50 p-4",children:ex.downloadURL&&ex.mimeType.startsWith("image/")?(0,t.jsx)("img",{src:ex.downloadURL,alt:ex.fileName,className:"max-h-[70vh] w-full rounded-xl object-contain"}):(0,t.jsx)("div",{className:"flex h-64 items-center justify-center rounded-xl bg-slate-100 text-sm text-slate-500",children:"無法預覽此檔案，請至檔案中心下載檢視。"})})]})}),D&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:A?"Edit":"Create"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:A?`編輯物料 ${V.code}`:"新增物料"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[A&&ej&&(0,t.jsx)("button",{type:"button",onClick:()=>{es({title:"",description:"",tags:"",isPrimary:!1}),ea(null),er(null),ei(null),ee(!0)},className:"rounded-full border border-slate-200 px-3 py-1 text-sm font-semibold text-slate-700 hover:border-teal-500 hover:text-teal-600",children:"上傳檔案"}),(0,t.jsx)("button",{onClick:ev,className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]})]}),(0,t.jsxs)("form",{onSubmit:eD,className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"物料型態"}),(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:u.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>ek(e.value),disabled:!!A,className:`rounded-full px-4 py-2 text-sm font-semibold ${V.type===e.value?"bg-slate-900 text-white":"border border-slate-200 text-slate-600"} disabled:opacity-60`,children:e.label},e.value))})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["料號",(0,t.jsx)("input",{type:"text",value:V.code,onChange:e=>ew("code",e.target.value.toUpperCase()),readOnly:!!A||!O,className:`mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none ${A||!O?"bg-slate-100":""}`})]}),eP&&(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:O,onChange:e=>eT(e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"使用萬用料號 (PS-0000A 可手動輸入)"]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["品名",(0,t.jsx)("input",{type:"text",value:V.name,onChange:e=>ew("name",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["規格",(0,t.jsx)("input",{type:"text",value:V.spec,onChange:e=>ew("spec",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["物料分類",(0,t.jsx)("select",{value:V.categoryCode,onChange:e=>ew("categoryCode",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:f.filter(e=>"active"===e.status).map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["計量單位",(0,t.jsx)("select",{value:V.unitCode,onChange:e=>ew("unitCode",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:y.map(e=>(0,t.jsxs)("option",{value:e.code,children:[e.code," ｜ ",e.name]},e.code))})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["預設倉庫",(0,t.jsxs)("select",{value:V.defaultWarehouseCode,onChange:e=>ew("defaultWarehouseCode",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"",children:"（未指定）"}),v.filter(e=>"active"===e.status).map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))]})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["首選供應商",(0,t.jsxs)("select",{value:V.preferredSupplierCode,onChange:e=>ew("preferredSupplierCode",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"",children:"（未指定）"}),C.map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))]})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["採購前置天數",(0,t.jsx)("input",{type:"number",min:0,value:V.purchaseLeadTimeDays,onChange:e=>ew("purchaseLeadTimeDays",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["參考成本",(0,t.jsx)("input",{type:"number",min:0,value:V.stdCost,onChange:e=>ew("stdCost",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["幣別",(0,t.jsx)("input",{type:"text",value:V.currency,onChange:e=>ew("currency",e.target.value.toUpperCase()),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"TWD / USD"})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["狀態",(0,t.jsxs)("select",{value:V.status,onChange:e=>ew("status",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"active",children:"使用中"}),(0,t.jsx)("option",{value:"inactive",children:"停用"})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:V.isStocked,onChange:e=>ew("isStocked",e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"納入庫存管控"]})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["備註",(0,t.jsx)("textarea",{value:V.note,onChange:e=>ew("note",e.target.value),rows:3,className:"mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"例如：僅用於某專案、需特殊檢驗..."})]}),z&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:z}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:ev,className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"取消"}),(0,t.jsx)("button",{type:"submit",disabled:$,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:opacity-50",children:$?"儲存中…":A?"更新物料":"建立物料"})]})]})]})}),Z&&A&&(0,t.jsx)("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Upload"}),(0,t.jsxs)("h2",{className:"text-xl font-semibold text-slate-900",children:["為 ",A," 上傳檔案"]}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"檔案會自動歸檔至檔案中心 · 物料模組"})]}),(0,t.jsx)("button",{onClick:eC,className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("form",{onSubmit:eg,className:"mt-4 space-y-4",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["主檔編號",(0,t.jsx)("input",{type:"text",value:A,readOnly:!0,className:"mt-1 w-full rounded-xl border border-slate-200 bg-slate-100 px-4 py-2 text-sm"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["檔案標題（選填）",(0,t.jsx)("input",{type:"text",value:et.title,onChange:e=>es(t=>({...t,title:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["說明（選填）",(0,t.jsx)("textarea",{value:et.description,onChange:e=>es(t=>({...t,description:e.target.value})),rows:3,className:"mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"輸入簡短說明以利辨識"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["標籤（以逗號或空白分隔）",(0,t.jsx)("input",{type:"text",value:et.tags,onChange:e=>es(t=>({...t,tags:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:et.isPrimary,onChange:e=>es(t=>({...t,isPrimary:e.target.checked})),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"將第一個檔案設為主照片"]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["選擇檔案",(0,t.jsx)("input",{type:"file",multiple:!0,onChange:e=>ea(e.target.files),className:"mt-1 w-full text-sm"}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"支援多檔同時上傳，建議單檔不超過 10MB。"})]}),ed&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:ed}),eo&&(0,t.jsx)("p",{className:"text-sm font-semibold text-emerald-600",children:eo}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:eC,className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"取消"}),(0,t.jsx)("button",{type:"submit",disabled:en,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:opacity-50",children:en?"上傳中…":"開始上傳"})]})]})]})}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Materials"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"物料主檔"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"零件與採購料的統一主檔，與 BOM、庫存、報價共用。"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700",children:"匯入清單"}),(0,t.jsx)("button",{onClick:()=>{M(null),K(!1),B(null),R(m(f[0]?.code)),L(!0),eS("PS")},disabled:!eh,className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white disabled:bg-slate-400",children:"新增物料"})]})]}),E&&(0,t.jsx)("p",{className:"mt-4 rounded-xl bg-emerald-50 px-4 py-2 text-sm font-semibold text-emerald-700",children:E})]}),(0,t.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),T(S)},className:"grid gap-4 rounded-2xl bg-slate-50/80 p-4 md:grid-cols-4",children:[(0,t.jsxs)("label",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"搜尋關鍵字"}),(0,t.jsx)("input",{type:"text",value:S.keyword,onChange:e=>k(t=>({...t,keyword:e.target.value})),placeholder:"料號 / 品名 / 規格",className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"物料型態"}),(0,t.jsxs)("select",{value:S.type,onChange:e=>k(t=>({...t,type:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"all",children:"全部型態"}),(0,t.jsx)("option",{value:"PS",children:"標準 (PS)"}),(0,t.jsx)("option",{value:"PM",children:"訂製 (PM)"}),(0,t.jsx)("option",{value:"PO",children:"其他 (PO)"})]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"分類"}),(0,t.jsxs)("select",{value:S.category,onChange:e=>k(t=>({...t,category:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"all",children:"全部分類"}),f.map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"狀態"}),(0,t.jsxs)("select",{value:S.status,onChange:e=>k(t=>({...t,status:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"all",children:"全部狀態"}),(0,t.jsx)("option",{value:"active",children:"使用中"}),(0,t.jsx)("option",{value:"inactive",children:"停用"})]})]}),(0,t.jsxs)("div",{className:"flex items-end gap-2 md:col-span-4 md:justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{k(x),T(x)},className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"重置"}),(0,t.jsx)("button",{type:"submit",className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm",children:"套用篩選"})]})]})}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:["已篩選 ",ey.length," 筆物料（共 ",h.length," 筆）"]})}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto rounded-xl border border-slate-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsx)("tr",{children:["料號","品名 / 規格","型態","分類","單位","預設倉庫","狀態","操作"].map(e=>(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:e},e))})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-50",children:ey.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-slate-50/70",children:[(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 font-semibold text-slate-900",children:e.code}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:e.spec||"—"})]}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("span",{className:"rounded-full bg-slate-900/10 px-3 py-1 text-xs font-semibold text-slate-700",children:e.type})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-700",children:eL(e.categoryCode)}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-700",children:eW(e.unitCode)}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-700",children:eU(e.defaultWarehouseCode)}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${"active"===e.status?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:"active"===e.status?"使用中":"停用"})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{q(e),U(!0)},disabled:!ep,className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 disabled:opacity-40",children:"檢視"}),(0,t.jsx)("button",{onClick:()=>{M(e.code),K(!1),R({code:e.code,name:e.name,spec:e.spec??"",type:e.type,categoryCode:e.categoryCode,unitCode:e.unitCode,defaultWarehouseCode:e.defaultWarehouseCode??"",preferredSupplierCode:e.preferredSupplierCode??"",purchaseLeadTimeDays:void 0!==e.purchaseLeadTimeDays?e.purchaseLeadTimeDays.toString():"",stdCost:void 0!==e.stdCost?e.stdCost.toString():"",currency:e.currency??"TWD",status:e.status,isStocked:e.isStocked,note:e.note??""}),B(null),L(!0)},disabled:!eb,className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 disabled:opacity-40",children:"編輯"}),"PM"===e.type&&!e.isVariant&&(0,t.jsx)("button",{type:"button",onClick:()=>{M(null),K(!1),B(null),R({code:e.code,name:`${e.name} 子料`,spec:e.spec??"",type:"PM",categoryCode:e.categoryCode,unitCode:e.unitCode,defaultWarehouseCode:e.defaultWarehouseCode??"",preferredSupplierCode:e.preferredSupplierCode??"",purchaseLeadTimeDays:void 0!==e.purchaseLeadTimeDays?e.purchaseLeadTimeDays.toString():"",stdCost:void 0!==e.stdCost?e.stdCost.toString():"",currency:e.currency??"TWD",status:"active",isStocked:!1,note:"",baseCode:e.baseCode??e.code,isVariant:!0}),eN(e.baseCode??e.code),L(!0)},disabled:!eh,className:"rounded-full border border-teal-200 px-3 py-1 text-xs font-semibold text-teal-600 disabled:opacity-40",children:"建立子料"})]})})]},e.code))})]})})]})]})}e.s(["MaterialDirectory",()=>p])}]);