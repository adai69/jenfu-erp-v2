(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,8922,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(36180);var l=e.i(98925),a=e.i(74503),r=e.i(57951);let d=[{label:"全部狀態",value:"all"},{label:"等待處理",value:"pending"},{label:"已完成",value:"completed"},{label:"已拒絕",value:"rejected"},{label:"失敗",value:"failed"}],x={keyword:"",state:"all"},i={pending:{label:"等待處理",className:"bg-slate-100 text-slate-600"},completed:{label:"已建立",className:"bg-emerald-50 text-emerald-700"},rejected:{label:"已拒絕",className:"bg-red-50 text-red-600"},failed:{label:"失敗",className:"bg-amber-50 text-amber-700"}},c=e=>{if(!e)return"—";let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),a=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0");return`${t}/${s}/${l} ${a}:${r}`};function n(){let{claims:e}=(0,r.useAuth)(),n=(e?.roles??[]).includes("admin"),[o,m]=(0,s.useState)([]),[p,h]=(0,s.useState)(x),[u,b]=(0,s.useState)(x),[j,N]=(0,s.useState)(!0),[f,g]=(0,s.useState)(null),[y,v]=(0,s.useState)(null);(0,s.useEffect)(()=>{n&&(async()=>{N(!0);try{let e=(await (0,l.getDocs)((0,l.collection)(a.db,"userProvisioning"))).docs.map(e=>{var t,s;let l,a,r;return t=e.data(),s=e.id,l=t.payload??{},a=t.createdAt,r=t.completedAt,{id:s,code:l.id??s,name:l.name??"",email:l.email??"",primaryRole:l.primaryRole??"",departments:l.departments??[],status:l.status??"active",requestedBy:t.requestedBy??"未知",requestedByUid:t.requestedByUid,state:t.state,error:t.error,createdAt:a?.toDate(),completedAt:r?.toDate()}}).sort((e,t)=>{let s=e.createdAt?.getTime()??0;return(t.createdAt?.getTime()??0)-s});m(e)}catch(e){console.error("Failed to load user provisioning queue",e),g("讀取帳號佇列資料失敗，請稍後再試。")}finally{N(!1)}})()},[n]);let w=(0,s.useMemo)(()=>{let e=u.keyword.trim().toLowerCase();return o.filter(t=>{let s=!e||[t.code,t.name,t.email,t.requestedBy,t.requestedByUid??""].join(" ").toLowerCase().includes(e),l="all"===u.state||t.state===u.state;return s&&l})},[u,o]);return n?(0,t.jsxs)(t.Fragment,{children:[y&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"max-h-[90vh] w-full max-w-3xl overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Request"}),(0,t.jsxs)("h2",{className:"text-xl font-semibold text-slate-900",children:[y.name,"（",y.code,"）"]})]}),(0,t.jsx)("button",{onClick:()=>v(null),className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,t.jsxs)("section",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"新帳號資訊"}),(0,t.jsx)("p",{className:"mt-2 text-sm font-semibold text-slate-900",children:y.name}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:y.email}),(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs",children:[(0,t.jsxs)("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-600",children:["角色：",y.primaryRole]}),(0,t.jsxs)("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-600",children:["狀態：","active"===y.status?"啟用":"停用"]})]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["部門：",y.departments.length?y.departments.join(" / "):"—"]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"發起人"}),(0,t.jsx)("p",{className:"mt-2 text-sm font-semibold text-slate-900",children:y.requestedBy||"未知"}),(0,t.jsxs)("p",{className:"text-xs text-slate-500",children:["UID：",y.requestedByUid??"—"]}),(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"建立時間"}),(0,t.jsx)("p",{className:"text-sm text-slate-900",children:c(y.createdAt)})]}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"完成時間"}),(0,t.jsx)("p",{className:"text-sm text-slate-900",children:c(y.completedAt)})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"狀態"}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${i[y.state]?.className??"bg-slate-100 text-slate-600"}`,children:i[y.state]?.label??y.state}),(0,t.jsx)("span",{className:"text-slate-500",children:y.error?`原因：${y.error}`:"無錯誤"})]})]})]})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"USER PROVISIONING"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"帳號建立佇列"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"顯示最近送出的帳號建立請求與狀態。"})]})}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),b(p)},className:"mt-6 grid gap-4 rounded-2xl bg-slate-50/80 p-4 md:grid-cols-4",children:[(0,t.jsxs)("label",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"搜尋關鍵字"}),(0,t.jsx)("input",{type:"text",value:p.keyword,onChange:e=>h(t=>({...t,keyword:e.target.value})),placeholder:"帳號代碼 / Email / 發起人",className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"狀態"}),(0,t.jsx)("select",{value:p.state,onChange:e=>h(t=>({...t,state:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:d.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"flex items-end gap-2 md:justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{h(x),b(x)},className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"重置"}),(0,t.jsx)("button",{type:"submit",className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm",children:"套用搜尋"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsx)("p",{className:"text-sm text-slate-500",children:j?"載入中…":`已篩選 ${w.length} 筆請求（共 ${o.length} 筆）`}),f&&(0,t.jsx)("p",{className:"text-xs font-semibold text-red-600",children:f})]}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto rounded-xl border border-slate-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsx)("tr",{children:["帳號代碼","新帳號資訊","發起人","狀態","錯誤","建立時間",""].map(e=>(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:e},e))})}),(0,t.jsxs)("tbody",{className:"divide-y divide-slate-50",children:[w.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-slate-50/70",children:[(0,t.jsxs)("td",{className:"whitespace-nowrap px-4 py-3 font-semibold text-slate-900",children:[e.code,(0,t.jsx)("p",{className:"text-xs text-slate-500",children:e.id})]}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("p",{className:"font-semibold text-slate-900",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:e.email}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:[(0,t.jsxs)("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-600",children:["角色：",e.primaryRole]}),e.departments.length>0&&(0,t.jsxs)("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-600",children:["部門：",e.departments.join(" / ")]})]})]}),(0,t.jsxs)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-600",children:[(0,t.jsx)("p",{className:"font-semibold text-slate-900",children:e.requestedBy||"未知"}),(0,t.jsxs)("p",{className:"text-xs text-slate-500",children:["UID：",e.requestedByUid??"—"]})]}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${i[e.state]?.className??"bg-slate-100 text-slate-600"}`,children:i[e.state]?.label??e.state})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-xs text-slate-500",children:e.error??"—"}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-xs text-slate-500",children:c(e.createdAt)}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-right",children:(0,t.jsx)("button",{onClick:()=>v(e),className:"text-xs font-semibold text-teal-600 hover:text-teal-700",children:"檢視"})})]},e.id)),!j&&0===w.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-sm text-slate-500",children:"沒有符合條件的帳號建立請求。"})})]})]})})]})]})]}):(0,t.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-sm text-slate-500",children:"目前帳號沒有檢視帳號佇列的權限。"})}e.s(["UserProvisioningDirectory",()=>n])}]);