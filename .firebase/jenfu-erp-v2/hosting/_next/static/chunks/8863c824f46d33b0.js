(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,47821,e=>{"use strict";e.s(["materialCategories",0,[{code:"MECH",name:"機構零件",type:"part",description:"焊接件、加工件、鈑金、鋼構等機械零件",status:"active",sortOrder:10},{code:"ELEC",name:"電控零件",type:"part",description:"電機、電控相關元件與線材",status:"active",sortOrder:20},{code:"CHEM",name:"藥劑耗材",type:"purchase",description:"藥劑、濾材、耗材等採購品",status:"active",sortOrder:30},{code:"STD",name:"標準件",type:"part",description:"螺絲、束帶、氣壓配件等標準採購件",status:"active",sortOrder:40},{code:"PACK",name:"包材 / 配件",type:"other",description:"包裝材料、工具、組裝配件",status:"active",sortOrder:50}],"materials",0,[{code:"PS-00001",name:"BS3X5 下軸承座",spec:"3X5mm, SS400+鍍鋅",type:"PS",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-MAIN",preferredSupplierCode:"SUP0001",purchaseLeadTimeDays:12,stdCost:4500,currency:"TWD",status:"active",isStocked:!0,note:"標準採購件，適用油水分離機 BS 系列",isVariant:!1},{code:"PM-00001",name:"絞爪 3X5-2 用",spec:"2mm, 客製長 780mm",type:"PM",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-WIP",preferredSupplierCode:"SUP0002",purchaseLeadTimeDays:20,status:"active",isStocked:!1,note:"訂製件，目前僅供案號 2025-BS-021 使用",baseCode:"PM-00001",isVariant:!1},{code:"PO-00001",name:"除油劑 A 配方",spec:"液態 25L/桶",type:"PO",categoryCode:"CHEM",unitCode:"L",defaultWarehouseCode:"WH-MAT",preferredSupplierCode:"SUP0003",purchaseLeadTimeDays:15,stdCost:1800,currency:"TWD",status:"active",isStocked:!0,note:"採購品，需低溫存放",isVariant:!1},{code:"PM-00001-00001",name:"絞爪 3X5-2 客製尺寸 1",spec:"2mm, 客製長 820mm",type:"PM",categoryCode:"MECH",unitCode:"EA",defaultWarehouseCode:"WH-WIP",preferredSupplierCode:"SUP0002",purchaseLeadTimeDays:20,status:"active",isStocked:!1,baseCode:"PM-00001",variantNo:"00001",isVariant:!0,note:"PM-00001 子料，案號 2025-BS-021 變形 A"}],"paymentTerms",0,[{code:"NET30",name:"貨到 30 天內付款",category:"net",netDays:30,status:"active",description:"出貨日 + 30 天付款",sortOrder:10},{code:"MONTH30",name:"月結 30 天",category:"monthly",monthlyOffset:30,status:"active",description:"每月月底結算，次月 30 日付款",sortOrder:20},{code:"COD",name:"貨到付現",category:"cash",status:"active",description:"交貨時付款",sortOrder:30},{code:"PREPAY30_70",name:"預付30%＋尾款70%",category:"installment",status:"active",description:"下單預付30%，出貨前付清剩餘70%",sortOrder:40},{code:"ON_HOLD",name:"暫停付款條款",category:"installment",status:"inactive",description:"僅留存紀錄，不提供新單據使用",sortOrder:90}],"sequences",0,[{key:"QUOTE",prefix:"QU",padding:4,nextNumber:128,scope:"報價"},{key:"ORDER",prefix:"SO",padding:5,nextNumber:3021,scope:"訂單"},{key:"WO",prefix:"WO",padding:5,nextNumber:873,scope:"製令"},{key:"SERIAL",prefix:"CFM",padding:6,nextNumber:54219,scope:"序號"},{key:"USER",prefix:"JFS",padding:4,nextNumber:1,scope:"帳號"},{key:"PART_PS",prefix:"PS-",padding:5,nextNumber:1,scope:"帳號"},{key:"PART_PM",prefix:"PM-",padding:5,nextNumber:1,scope:"帳號"},{key:"PART_PO",prefix:"PO-",padding:5,nextNumber:1,scope:"帳號"},{key:"SUPPLIER",prefix:"SUP",padding:4,nextNumber:4,scope:"帳號"}],"suppliers",0,[{code:"SUP0001",name:"亞鋼金屬",contact:"陳小姐",phone:"02-1234-5678",level:"A",leadTimeDays:12,status:"active",email:"sales@acm.com.tw",address:"台中市大肚區工業路 100 號",paymentTermCode:"MONTH30",taxId:"12345678",note:"主要供應 SS 板材"},{code:"SUP0002",name:"鑫泉幫浦",contact:"吳經理",phone:"04-8765-4321",level:"A",leadTimeDays:20,status:"active",email:"service@pump.com.tw",paymentTermCode:"NET30"},{code:"SUP0003",name:"沛富化工原料",contact:"林先生",phone:"07-2222-8888",level:"B",leadTimeDays:15,status:"suspended",note:"僅供偶爾訂單使用"}],"units",0,[{code:"EA",name:"台",category:"count",conversion:"1 台 = 1 件"},{code:"SET",name:"套",category:"count",conversion:"1 套 = 多件零組"},{code:"BAR",name:"條",category:"count",conversion:"1 條 = 1 件"},{code:"KG",name:"公斤",category:"weight",conversion:"1 kg = 1000 g"},{code:"L",name:"公升",category:"volume",conversion:"1 L = 1000 mL"},{code:"MM",name:"毫米",category:"length",conversion:"1 mm = 0.001 m"},{code:"LPM",name:"公升/分鐘",category:"flow",conversion:"1 LPM = 0.001 m³/min"},{code:"M3H",name:"立方米/小時",category:"flow",conversion:"1 m³/h = 16.67 LPM"},{code:"DEG-C",name:"攝氏度",category:"temperature",conversion:"基準溫標 °C"},{code:"DEG-F",name:"華氏度",category:"temperature",conversion:"°F = °C × 1.8 + 32"}],"users",0,[{id:"U-001",name:"張仕杰",primaryRole:"admin",roles:[{role:"admin",departments:["executive","rd","finance","management"],isPrimary:!0},{role:"manager",departments:["rd","finance"]}],departments:["executive","rd","finance","management"],email:"ceo@cfm.com",status:"active",moduleOverrides:{quotes:["approve","lock","cancel"],orders:["approve","lock","cancel"]}},{id:"U-002",name:"張成漢",primaryRole:"manager",roles:[{role:"manager",departments:["production","sales"],isPrimary:!0},{role:"operator",departments:["production"]}],departments:["production","sales"],email:"operation@cfm.com",status:"active",moduleOverrides:{inventory:["lock"],production:["lock"]}},{id:"U-003",name:"張祐豪",primaryRole:"planner",roles:[{role:"planner",departments:["management","sales"],isPrimary:!0},{role:"manager",departments:["management"]}],departments:["management","sales"],email:"planner@cfm.com",status:"active"},{id:"U-004",name:"阮梓明",primaryRole:"operator",roles:[{role:"operator",departments:["production"]}],departments:["production"],email:"worker.vn@cfm.com",status:"active"}],"warehouses",0,[{code:"WH-MAIN",name:"主倉",type:"raw",status:"active",isDefaultReceive:!0,isDefaultIssue:!0,sortOrder:10,address:"台中大肚廠內一樓",note:"零件材料主要存放區"},{code:"WH-MAT",name:"材料倉",type:"raw",status:"active",sortOrder:20,address:"台中大肚廠內二樓",note:"板金 / 型材 / 標準件"},{code:"WH-FG",name:"成品倉",type:"fg",status:"active",sortOrder:30,address:"台中大肚廠外成品棚"},{code:"WH-WIP",name:"組裝暫存區",type:"wip",status:"active",sortOrder:40,note:"組裝工位旁暫存架"},{code:"WH-OUT-TC",name:"外包倉-台中",type:"other",status:"active",sortOrder:50,note:"外包加工廠暫存"}]])},84616,43873,78598,e=>{"use strict";var t=e.i(71645);e.s(["DEPARTMENT_DEFINITIONS",0,{executive:{label:"經營",description:"決策／策略"},rd:{label:"研發",description:"產品與設計"},production:{label:"生產",description:"製造與現場"},sales:{label:"營銷",description:"業務與客服"},management:{label:"管理",description:"行政／管理"},finance:{label:"財務",description:"財會／稽核"}},"ROLE_DEFINITIONS",0,{admin:{label:"Admin",description:"序號調整、審核、最高權限",hierarchy:4},manager:{label:"Manager",description:"日常維運與審核啟動",hierarchy:3},planner:{label:"Planner",description:"草稿建立、流程規劃",hierarchy:2},operator:{label:"Operator",description:"查詢與執行現場作業",hierarchy:1}}],43873);let s={users:{label:"使用者",description:"帳號與權限"},units:{label:"計量單位",description:"跨模組基本單位"},suppliers:{label:"供應商",description:"採購夥伴"},customers:{label:"客戶",description:"營銷對象"},parts:{label:"零件",description:"料號與成本"},products:{label:"產品",description:"BOM 與模組"},categories:{label:"類別",description:"物料分類"},sequences:{label:"序號",description:"Prefix / 流水"},quotes:{label:"報價",description:"報價單與交期"},orders:{label:"訂單",description:"接單與變更"},inventory:{label:"庫存",description:"入出庫與盤點"},production:{label:"產品/製令",description:"工單與製造履歷"},materials:{label:"物料",description:"零件與採購料主檔"}},a={view:"檢視",create:"新增",update:"編輯",disable:"停用",approve:"核准",lock:"鎖定","sequence-adjust":"調整序號",cancel:"作廢"},r={admin:{users:["view","create","update","disable","approve"],units:["view","create","update","disable","approve"],suppliers:["view","create","update","disable","approve"],customers:["view","create","update","disable","approve"],parts:["view","create","update","disable","approve"],products:["view","create","update","disable","approve"],categories:["view","create","update","disable","approve"],sequences:["view","lock","sequence-adjust","approve"],quotes:["view","create","update","approve","lock","cancel"],orders:["view","create","update","approve","lock","cancel"],inventory:["view","create","update","lock"],production:["view","create","update","approve","lock"],materials:["view","create","update","disable"]},manager:{users:["view","create","update","disable"],units:["view","create","update","disable"],suppliers:["view","create","update"],customers:["view","create","update"],parts:["view","create","update","disable"],products:["view","create","update"],categories:["view","create","update"],sequences:["view","lock"],quotes:["view","create","update","lock"],orders:["view","create","update","lock"],inventory:["view","create","update"],production:["view","create","update"],materials:["view","create","update"]},planner:{users:["view"],units:["view","create"],suppliers:["view","create"],customers:["view","create"],parts:["view","create"],products:["view","create"],categories:["view","create"],sequences:["view"],quotes:["view","create"],orders:["view","create"],inventory:["view","create"],production:["view","create"],materials:["view","create"]},operator:{users:["view"],units:["view"],suppliers:["view"],customers:["view"],parts:["view"],products:["view"],categories:["view"],sequences:["view"],quotes:["view"],orders:["view"],inventory:["view"],production:["view"],materials:["view"]}};function l(e,t){let s={users:[],units:[],suppliers:[],customers:[],parts:[],products:[],categories:[],materials:[],sequences:[],quotes:[],orders:[],inventory:[],production:[]},{roleFilter:a,departmentFilter:l}=t??{},o=e.filter(e=>{let t=!a||e.role===a,s=!l||!e.departments.length||e.departments.includes(l);return t&&s});if(!o.length)return s;for(let e of o)Object.entries(r[e.role]).forEach(([e,t])=>{let a=new Set(s[e]);t.forEach(e=>a.add(e)),s[e]=Array.from(a)});return s}function o(e,t,s,a){let r=l(e,a);return r[t]?.includes(s)??!1}function d({assignments:e,roleFilter:s,departmentFilter:a}){return{profile:(0,t.useMemo)(()=>l(e,{roleFilter:s,departmentFilter:a}),[e,s,a]),can:(t,r)=>o(e,t,r,{roleFilter:s,departmentFilter:a})}}e.s(["ACTION_LABELS",()=>a,"MODULE_DEFINITIONS",()=>s,"buildPermissionProfile",()=>l,"canPerformAction",()=>o],78598),e.s(["usePermission",()=>d],84616)},27379,e=>{"use strict";let t=new Map(e.i(47821).sequences.map(e=>[e.key,{...e}]));function s(e){let s=t.get(e);if(!s)throw Error(`Sequence ${e} not found`);let a=function(e,s){let a=t.get(e);if(!a)throw Error(`Sequence ${e} not found`);return`${a.prefix}${s.toString().padStart(a.padding,"0")}`}(e,s.nextNumber);return s.nextNumber+=1,{key:e,value:a,issuedNumber:s.nextNumber-1}}e.s(["issueSequence",()=>s])},19494,e=>{"use strict";var t=e.i(43476),s=e.i(71645);e.i(36180);var a=e.i(98925),r=e.i(74503),l=e.i(47821),o=e.i(27379),d=e.i(84616);let i={keyword:"",type:"all",category:"all",status:"all"},c=(e,t)=>({code:"",name:"",spec:"",type:"PS",categoryCode:e??l.materialCategories[0]?.code??"",unitCode:l.units[0]?.code??"",defaultWarehouseCode:"",preferredSupplierCode:"",purchaseLeadTimeDays:"",stdCost:"",currency:"TWD",status:"active",isStocked:!0,note:"",baseCode:t,isVariant:!!t}),n=[{label:"標準 (PS)",value:"PS"},{label:"訂製 (PM)",value:"PM"},{label:"其他 (PO)",value:"PO"}];function m(){let e,m,[p,u]=(0,s.useState)(l.materials),[x,b]=(0,s.useState)(l.materialCategories),[h,v]=(0,s.useState)(l.units),[f,y]=(0,s.useState)(l.warehouses),[g,j]=(0,s.useState)(l.suppliers),[N,C]=(0,s.useState)(i),[w,S]=(0,s.useState)(i),[k,P]=(0,s.useState)(!1),[T,D]=(0,s.useState)(!1),[O,M]=(0,s.useState)(null),[W,E]=(0,s.useState)(()=>c(l.materialCategories[0]?.code)),[L,A]=(0,s.useState)(!1),[R,U]=(0,s.useState)(null),[q,I]=(0,s.useState)(null),[V,H]=(0,s.useState)(!1),[$,F]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{let[e,t,s,o]=await Promise.all([(0,a.getDocs)((0,a.collection)(r.db,"materialCategories")),(0,a.getDocs)((0,a.collection)(r.db,"units")),(0,a.getDocs)((0,a.collection)(r.db,"warehouses")),(0,a.getDocs)((0,a.collection)(r.db,"suppliers"))]),d=e.docs.length>0?e.docs.map(e=>{let t=e.data();return{...t,code:t.code??e.id}}):l.materialCategories;b(d);let i=t.docs.length>0?t.docs.map(e=>({...e.data()})):l.units;v(i);let c=s.docs.length>0?s.docs.map(e=>({...e.data()})):l.warehouses;y(c);let n=o.docs.length>0?o.docs.map(e=>({...e.data()})):l.suppliers;j(n)}catch(e){console.error("Failed to load reference data for materials",e)}})()},[]),(0,s.useEffect)(()=>{(async()=>{try{let e=(await (0,a.getDocs)((0,a.collection)(r.db,"materials"))).docs.map(e=>{let t,s;return t=e.data(),s=e.id,{code:t.code??s,name:t.name??"",spec:t.spec,type:t.type??"PS",categoryCode:t.categoryCode??"",unitCode:t.unitCode??"",defaultWarehouseCode:t.defaultWarehouseCode,preferredSupplierCode:t.preferredSupplierCode,purchaseLeadTimeDays:"number"==typeof t.purchaseLeadTimeDays?t.purchaseLeadTimeDays:void 0,stdCost:"number"==typeof t.stdCost?t.stdCost:void 0,currency:t.currency,status:t.status??"active",isStocked:!!t.isStocked,note:t.note,baseCode:t.baseCode,variantNo:t.variantNo,isVariant:!0===t.isVariant||!!t.variantNo}});e.length&&u(t=>{let s=new Map(t.map(e=>[e.code,e]));return e.forEach(e=>s.set(e.code,e)),Array.from(s.values())})}catch(e){console.error("Failed to load materials",e)}})()},[]),(0,s.useEffect)(()=>{if(!k&&!T)return;let e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[k,T]);let _=l.users[0],{can:B}=(0,d.usePermission)({assignments:_.roles,roleFilter:_.primaryRole,departmentFilter:_.departments[0]}),G=B("materials","view"),K=B("materials","create"),X=B("materials","update"),z=(0,s.useMemo)(()=>p.filter(e=>{let t=w.keyword.trim().toLowerCase(),s=!t||[e.code,e.name,e.spec??""].join(" ").toLowerCase().includes(t),a="all"===w.type||e.type===w.type,r="all"===w.category||e.categoryCode===w.category,l="all"===w.status||e.status===w.status;return s&&a&&r&&l}),[w,p]),Q=()=>{P(!1),E(c(x[0]?.code)),U(null),M(null),H(!1)},J=(e,t)=>{E(s=>({...s,[e]:t}))},Y=e=>{if(!O&&!V&&!W.isVariant)try{let t=(0,o.issueSequence)("PS"===e?"PART_PS":"PM"===e?"PART_PM":"PART_PO");E(e=>({...e,code:t.value}))}catch{U("取得料號時發生問題，請稍後再試。")}},Z=!O&&"PS"===W.type,ee=async e=>{if(e.preventDefault(),L)return;let t=W.name.trim(),s=W.code.trim();if(!s)return void U("料號取得失敗，請重新選擇型態或重新整理頁面。");if(!t)return void U("請輸入品名");if(!W.categoryCode)return void U("請選擇物料分類");if(!W.unitCode)return void U("請選擇計量單位");let l=""===W.purchaseLeadTimeDays.trim()?void 0:Number.parseInt(W.purchaseLeadTimeDays,10);if(void 0!==l&&Number.isNaN(l))return void U("採購前置天數需為數字");let o=""===W.stdCost.trim()?void 0:Number.parseFloat(W.stdCost);if(void 0!==o&&Number.isNaN(o))return void U("參考成本需為數字");A(!0),U(null);let d={code:s,name:t,spec:W.spec.trim(),type:W.type,categoryCode:W.categoryCode,unitCode:W.unitCode,defaultWarehouseCode:W.defaultWarehouseCode||null,preferredSupplierCode:W.preferredSupplierCode||null,purchaseLeadTimeDays:l??null,stdCost:o??null,currency:W.currency.trim()||"TWD",status:W.status,isStocked:W.isStocked,note:W.note.trim(),baseCode:W.isVariant&&W.baseCode?W.baseCode:W.isVariant?s.split("-")[0]:null,variantNo:W.isVariant&&s.includes("-")?s.split("-").pop():null,isVariant:W.isVariant??!1,updatedAt:(0,a.serverTimestamp)(),...O?{}:{createdAt:(0,a.serverTimestamp)()}};try{await (0,a.setDoc)((0,a.doc)(r.db,"materials",s),d,{merge:!0}),u(e=>{let a=e.filter(e=>e.code!==s);return a.push({code:s,name:t,spec:W.spec.trim()||void 0,type:W.type,categoryCode:W.categoryCode,unitCode:W.unitCode,defaultWarehouseCode:W.defaultWarehouseCode||void 0,preferredSupplierCode:W.preferredSupplierCode||void 0,purchaseLeadTimeDays:l,stdCost:o,currency:d.currency,status:W.status,isStocked:W.isStocked,note:W.note.trim()||void 0,baseCode:d.baseCode??void 0,variantNo:d.variantNo??void 0,isVariant:d.isVariant??!1}),a}),I(O?`已更新 ${s}`:`已新增 ${s}`),Q()}catch(e){console.error("Failed to save material",e),U("儲存物料時發生錯誤，請稍後再試。")}finally{A(!1)}},et=e=>x.find(t=>t.code===e)?.name??e,es=e=>h.find(t=>t.code===e)?.name??e,ea=e=>e?f.find(t=>t.code===e)?.name??e:"—";return(0,t.jsxs)("div",{className:"space-y-6",children:[T&&$&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"View"}),(0,t.jsxs)("h2",{className:"text-xl font-semibold text-slate-900",children:["檢視物料 ",$.code]})]}),(0,t.jsx)("button",{onClick:()=>{D(!1),F(null)},className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("div",{className:"mt-6 space-y-6",children:[(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"基本資料"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"料號"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:$.code})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"物料型態"}),(0,t.jsx)("p",{className:"mt-1 inline-flex items-center rounded-full bg-slate-900/5 px-3 py-1 text-xs font-semibold text-slate-700",children:(e=$.type,n.find(t=>t.value===e)?.label??e)})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"品名"}),(0,t.jsx)("p",{className:"mt-1 text-base font-semibold text-slate-900",children:$.name})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"規格"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-700",children:$.spec?.trim()||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"狀態"}),(0,t.jsx)("span",{className:`mt-1 inline-flex rounded-full px-3 py-1 text-xs font-semibold ${"active"===$.status?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:"active"===$.status?"使用中":"停用"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"庫存管控"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:$.isStocked?"納入":"不納入"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"分類與供應"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"分類"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:et($.categoryCode)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"計量單位"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:es($.unitCode)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"預設倉庫"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:ea($.defaultWarehouseCode)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"首選供應商"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:(m=$.preferredSupplierCode)?g.find(e=>e.code===m)?.name??m:"—"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"採購資訊"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"採購前置天數"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:$.purchaseLeadTimeDays??"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"參考成本"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:void 0!==$.stdCost?`${$.currency??"TWD"} ${$.stdCost}`:"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"備註"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-700",children:$.note?.trim()||"—"})]})]})]}),(0,t.jsxs)("section",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"子料資訊"}),(0,t.jsxs)("div",{className:"mt-3 grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"是否為子料"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:$.isVariant?"是":"否"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"母料號"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:$.baseCode??"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"子料編號"}),(0,t.jsx)("p",{className:"mt-1 text-sm font-semibold text-slate-900",children:$.variantNo??"—"})]})]})]})]})]})}),k&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:O?"Edit":"Create"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:O?`編輯物料 ${W.code}`:"新增物料"})]}),(0,t.jsx)("button",{onClick:Q,className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("form",{onSubmit:ee,className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"物料型態"}),(0,t.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:n.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.value,void(E(e=>({...e,type:t})),!V&&!O&&Y(t))},disabled:!!O,className:`rounded-full px-4 py-2 text-sm font-semibold ${W.type===e.value?"bg-slate-900 text-white":"border border-slate-200 text-slate-600"} disabled:opacity-60`,children:e.label},e.value))})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["料號",(0,t.jsx)("input",{type:"text",value:W.code,onChange:e=>J("code",e.target.value.toUpperCase()),readOnly:!!O||!V,className:`mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none ${O||!V?"bg-slate-100":""}`})]}),Z&&(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:V,onChange:e=>{var t;H(t=e.target.checked),t?E(e=>({...e,code:"PS-0000A"})):Y(W.type)},className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"使用萬用料號 (PS-0000A 可手動輸入)"]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["品名",(0,t.jsx)("input",{type:"text",value:W.name,onChange:e=>J("name",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["規格",(0,t.jsx)("input",{type:"text",value:W.spec,onChange:e=>J("spec",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["物料分類",(0,t.jsx)("select",{value:W.categoryCode,onChange:e=>J("categoryCode",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:x.filter(e=>"active"===e.status).map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["計量單位",(0,t.jsx)("select",{value:W.unitCode,onChange:e=>J("unitCode",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:h.map(e=>(0,t.jsxs)("option",{value:e.code,children:[e.code," ｜ ",e.name]},e.code))})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["預設倉庫",(0,t.jsxs)("select",{value:W.defaultWarehouseCode,onChange:e=>J("defaultWarehouseCode",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"",children:"（未指定）"}),f.filter(e=>"active"===e.status).map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))]})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["首選供應商",(0,t.jsxs)("select",{value:W.preferredSupplierCode,onChange:e=>J("preferredSupplierCode",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"",children:"（未指定）"}),g.map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))]})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["採購前置天數",(0,t.jsx)("input",{type:"number",min:0,value:W.purchaseLeadTimeDays,onChange:e=>J("purchaseLeadTimeDays",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["參考成本",(0,t.jsx)("input",{type:"number",min:0,value:W.stdCost,onChange:e=>J("stdCost",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["幣別",(0,t.jsx)("input",{type:"text",value:W.currency,onChange:e=>J("currency",e.target.value.toUpperCase()),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"TWD / USD"})]})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["狀態",(0,t.jsxs)("select",{value:W.status,onChange:e=>J("status",e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"active",children:"使用中"}),(0,t.jsx)("option",{value:"inactive",children:"停用"})]})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:W.isStocked,onChange:e=>J("isStocked",e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"納入庫存管控"]})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["備註",(0,t.jsx)("textarea",{value:W.note,onChange:e=>J("note",e.target.value),rows:3,className:"mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"例如：僅用於某專案、需特殊檢驗..."})]}),R&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:R}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:Q,className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"取消"}),(0,t.jsx)("button",{type:"submit",disabled:L,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:opacity-50",children:L?"儲存中…":O?"更新物料":"建立物料"})]})]})]})}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Materials"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"物料主檔"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"零件與採購料的統一主檔，與 BOM、庫存、報價共用。"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700",children:"匯入清單"}),(0,t.jsx)("button",{onClick:()=>{M(null),H(!1),U(null),E(c(x[0]?.code)),P(!0),Y("PS")},disabled:!K,className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white disabled:bg-slate-400",children:"新增物料"})]})]}),q&&(0,t.jsx)("p",{className:"mt-4 rounded-xl bg-emerald-50 px-4 py-2 text-sm font-semibold text-emerald-700",children:q})]}),(0,t.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),S(N)},className:"grid gap-4 rounded-2xl bg-slate-50/80 p-4 md:grid-cols-4",children:[(0,t.jsxs)("label",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"搜尋關鍵字"}),(0,t.jsx)("input",{type:"text",value:N.keyword,onChange:e=>C(t=>({...t,keyword:e.target.value})),placeholder:"料號 / 品名 / 規格",className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"物料型態"}),(0,t.jsxs)("select",{value:N.type,onChange:e=>C(t=>({...t,type:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"all",children:"全部型態"}),(0,t.jsx)("option",{value:"PS",children:"標準 (PS)"}),(0,t.jsx)("option",{value:"PM",children:"訂製 (PM)"}),(0,t.jsx)("option",{value:"PO",children:"其他 (PO)"})]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"分類"}),(0,t.jsxs)("select",{value:N.category,onChange:e=>C(t=>({...t,category:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"all",children:"全部分類"}),x.map(e=>(0,t.jsx)("option",{value:e.code,children:e.name},e.code))]})]}),(0,t.jsxs)("label",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-600",children:"狀態"}),(0,t.jsxs)("select",{value:N.status,onChange:e=>C(t=>({...t,status:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:[(0,t.jsx)("option",{value:"all",children:"全部狀態"}),(0,t.jsx)("option",{value:"active",children:"使用中"}),(0,t.jsx)("option",{value:"inactive",children:"停用"})]})]}),(0,t.jsxs)("div",{className:"flex items-end gap-2 md:col-span-4 md:justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{C(i),S(i)},className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"重置"}),(0,t.jsx)("button",{type:"submit",className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm",children:"套用篩選"})]})]})}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:["已篩選 ",z.length," 筆物料（共 ",p.length," 筆）"]})}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto rounded-xl border border-slate-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsx)("tr",{children:["料號","品名 / 規格","型態","分類","單位","預設倉庫","狀態","操作"].map(e=>(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:e},e))})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-50",children:z.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-slate-50/70",children:[(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 font-semibold text-slate-900",children:e.code}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:e.spec||"—"})]}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("span",{className:"rounded-full bg-slate-900/10 px-3 py-1 text-xs font-semibold text-slate-700",children:e.type})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-700",children:et(e.categoryCode)}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-700",children:es(e.unitCode)}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3 text-slate-700",children:ea(e.defaultWarehouseCode)}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsx)("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${"active"===e.status?"bg-emerald-50 text-emerald-700":"bg-slate-100 text-slate-500"}`,children:"active"===e.status?"使用中":"停用"})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-4 py-3",children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{F(e),D(!0)},disabled:!G,className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 disabled:opacity-40",children:"檢視"}),(0,t.jsx)("button",{onClick:()=>{M(e.code),H(!1),E({code:e.code,name:e.name,spec:e.spec??"",type:e.type,categoryCode:e.categoryCode,unitCode:e.unitCode,defaultWarehouseCode:e.defaultWarehouseCode??"",preferredSupplierCode:e.preferredSupplierCode??"",purchaseLeadTimeDays:void 0!==e.purchaseLeadTimeDays?e.purchaseLeadTimeDays.toString():"",stdCost:void 0!==e.stdCost?e.stdCost.toString():"",currency:e.currency??"TWD",status:e.status,isStocked:e.isStocked,note:e.note??""}),U(null),P(!0)},disabled:!X,className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 disabled:opacity-40",children:"編輯"}),"PM"===e.type&&!e.isVariant&&(0,t.jsx)("button",{type:"button",onClick:()=>{var t;let s,a;M(null),H(!1),U(null),E({code:e.code,name:`${e.name} 子料`,spec:e.spec??"",type:"PM",categoryCode:e.categoryCode,unitCode:e.unitCode,defaultWarehouseCode:e.defaultWarehouseCode??"",preferredSupplierCode:e.preferredSupplierCode??"",purchaseLeadTimeDays:void 0!==e.purchaseLeadTimeDays?e.purchaseLeadTimeDays.toString():"",stdCost:void 0!==e.stdCost?e.stdCost.toString():"",currency:e.currency??"TWD",status:"active",isStocked:!1,note:"",baseCode:e.baseCode??e.code,isVariant:!0}),t=e.baseCode??e.code,a=((s=p.filter(e=>(e.baseCode??e.code)===t&&e.variantNo)).length?Math.max(...s.map(e=>Number.parseInt(e.variantNo??"0",10)))+1:1).toString().padStart(5,"0"),E(e=>({...e,code:`${t}-${a}`,baseCode:t,isVariant:!0})),P(!0)},disabled:!K,className:"rounded-full border border-teal-200 px-3 py-1 text-xs font-semibold text-teal-600 disabled:opacity-40",children:"建立子料"})]})})]},e.code))})]})})]})]})}e.s(["MaterialDirectory",()=>m])}]);