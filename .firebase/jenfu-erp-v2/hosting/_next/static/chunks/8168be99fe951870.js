(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,84616,43873,78598,e=>{"use strict";var t=e.i(71645);e.s(["DEPARTMENT_DEFINITIONS",0,{executive:{label:"經營",description:"決策／策略"},rd:{label:"研發",description:"產品與設計"},production:{label:"生產",description:"製造與現場"},sales:{label:"營銷",description:"業務與客服"},management:{label:"管理",description:"行政／管理"},finance:{label:"財務",description:"財會／稽核"}},"ROLE_DEFINITIONS",0,{admin:{label:"Admin",description:"序號調整、審核、最高權限",hierarchy:4},manager:{label:"Manager",description:"日常維運與審核啟動",hierarchy:3},planner:{label:"Planner",description:"草稿建立、流程規劃",hierarchy:2},operator:{label:"Operator",description:"查詢與執行現場作業",hierarchy:1}}],43873);let s={users:{label:"使用者",description:"帳號與權限"},employees:{label:"員工",description:"人事資料卡"},units:{label:"計量單位",description:"跨模組基本單位"},suppliers:{label:"供應商",description:"採購夥伴"},brands:{label:"品牌",description:"品牌 / 製造商資訊"},countries:{label:"國家",description:"國別 / 幣別 / 區域"},purchaseMethods:{label:"採購方式",description:"採購策略與流程"},customers:{label:"客戶",description:"營銷對象"},parts:{label:"零件",description:"料號與成本"},products:{label:"產品",description:"BOM 與模組"},categories:{label:"類別",description:"物料分類"},files:{label:"檔案中心",description:"設計圖 / 圖片 / 附件"},sequences:{label:"序號",description:"Prefix / 流水"},quotes:{label:"報價",description:"報價單與交期"},orders:{label:"訂單",description:"接單與變更"},inventory:{label:"庫存",description:"入出庫與盤點"},production:{label:"產品/製令",description:"工單與製造履歷"},materials:{label:"物料",description:"零件與採購料主檔"}},l={view:"檢視",create:"新增",update:"編輯",disable:"停用",approve:"核准",lock:"鎖定","sequence-adjust":"調整序號",cancel:"作廢"},a={admin:{users:["view","create","update","disable","approve"],employees:["view","create","update","disable"],units:["view","create","update","disable","approve"],suppliers:["view","create","update","disable","approve"],brands:["view","create","update","disable"],countries:["view","create","update","disable"],purchaseMethods:["view","create","update","disable"],customers:["view","create","update","disable","approve"],parts:["view","create","update","disable","approve"],products:["view","create","update","disable","approve"],categories:["view","create","update","disable","approve"],sequences:["view","lock","sequence-adjust","approve"],quotes:["view","create","update","approve","lock","cancel"],orders:["view","create","update","approve","lock","cancel"],inventory:["view","create","update","lock"],production:["view","create","update","approve","lock"],materials:["view","create","update","disable"],files:["view","create","update","disable"]},manager:{users:["view","create","update","disable"],employees:["view","create","update"],units:["view","create","update","disable"],suppliers:["view","create","update"],brands:["view","create","update"],countries:["view","create","update"],purchaseMethods:["view","create","update"],customers:["view","create","update"],parts:["view","create","update","disable"],products:["view","create","update"],categories:["view","create","update"],sequences:["view","lock"],quotes:["view","create","update","lock"],orders:["view","create","update","lock"],inventory:["view","create","update"],production:["view","create","update"],materials:["view","create","update"],files:["view","create","update"]},planner:{users:["view"],employees:["view","create"],units:["view","create"],suppliers:["view","create"],brands:["view","create"],countries:["view"],purchaseMethods:["view","create"],customers:["view","create"],parts:["view","create"],products:["view","create"],categories:["view","create"],sequences:["view"],quotes:["view","create"],orders:["view","create"],inventory:["view","create"],production:["view","create"],materials:["view","create"],files:["view","create"]},operator:{users:["view"],employees:["view"],units:["view"],suppliers:["view"],brands:["view"],countries:["view"],purchaseMethods:["view"],customers:["view"],parts:["view"],products:["view"],categories:["view"],sequences:["view"],quotes:["view"],orders:["view"],inventory:["view"],production:["view"],materials:["view"],files:["view"]}};function r(e,t){let s={users:[],employees:[],units:[],suppliers:[],brands:[],countries:[],purchaseMethods:[],customers:[],parts:[],products:[],categories:[],materials:[],files:[],sequences:[],quotes:[],orders:[],inventory:[],production:[]},{roleFilter:l,departmentFilter:r}=t??{},i=e.filter(e=>{let t=!l||e.role===l,s=!r||!e.departments.length||e.departments.includes(r);return t&&s});if(!i.length)return s;for(let e of i)Object.entries(a[e.role]).forEach(([e,t])=>{let l=new Set(s[e]);t.forEach(e=>l.add(e)),s[e]=Array.from(l)});return s}function i(e,t,s,l){let a=r(e,l);return a[t]?.includes(s)??!1}e.s(["ACTION_LABELS",()=>l,"MODULE_DEFINITIONS",()=>s,"buildPermissionProfile",()=>r,"canPerformAction",()=>i],78598);var d=e.i(57951);function o(e){let{assignments:s,roleFilter:l,departmentFilter:a}=e??{},{claims:o}=(0,d.useAuth)(),n=!!(s&&s.length),c=(0,t.useMemo)(()=>{if(!o?.roles?.length)return[];let e=o.departments??[];return o.roles.map(t=>({role:t,departments:e}))},[o?.departments,o?.roles]),m=(0,t.useMemo)(()=>{if(n&&s)return r(s,{roleFilter:l,departmentFilter:a});let e=o?.modules;if(e){let t=r(c,{roleFilter:l,departmentFilter:a});return Object.keys(t).forEach(s=>{let l=e[s];Array.isArray(l)&&(t[s]=l)}),t}return c.length?r(c,{roleFilter:l,departmentFilter:a}):null},[s,o?.modules,a,c,l,n]);return{profile:m,can:(e,t)=>{if(n&&s)return i(s,e,t,{roleFilter:l,departmentFilter:a});let r=m?.[e];return!!Array.isArray(r)&&r.includes(t)}}}e.s(["usePermission",()=>o],84616)},9348,e=>{"use strict";e.i(36180);var t=e.i(98925);e.i(61086);var s=e.i(27215),l=e.i(74503);async function a(e,s,a){let r=(await (0,t.getDocs)((0,t.query)((0,t.collection)(l.db,"files"),(0,t.where)("targetModule","==",e),(0,t.where)("entityId","==",s),(0,t.where)("isPrimary","==",!0)))).docs.filter(e=>e.id!==a).map(e=>(0,t.updateDoc)(e.ref,{isPrimary:!1}));await Promise.all(r)}async function r({module:e,entityId:r,files:i,metadata:d,createdBy:o}){if(!r.trim()||0===i.length)throw Error("entityId 和 files 為必填");let n=r.trim(),c=d?.title?.trim(),m=d?.description?.trim(),u=d?.tags?.filter(e=>e.trim())??[];d?.setPrimary&&await a(e,n);for(let a=0;a<i.length;a+=1){let r=i[a],x=`${e}/${n}/${Date.now()}-${r.name}`;await (0,s.uploadBytes)((0,s.ref)(l.storage,x),r),await (0,t.addDoc)((0,t.collection)(l.db,"files"),{targetModule:e,entityId:n,storagePath:x,fileName:r.name,mimeType:r.type||"application/octet-stream",size:r.size,title:c||r.name,description:m||null,tags:u,isPrimary:!!d?.setPrimary&&0===a,orderIndex:Date.now()+a,createdAt:(0,t.serverTimestamp)(),createdByUid:o?.uid??null,createdByName:o?.name??"system"})}}e.s(["clearExistingPrimary",()=>a,"uploadFilesForEntity",()=>r])},36886,e=>{"use strict";var t=e.i(43476),s=e.i(18566),l=e.i(71645);e.i(36180);var a=e.i(98925);e.i(61086);var r=e.i(27215),i=e.i(78598),d=e.i(74503),o=e.i(84616),n=e.i(57951),c=e.i(9348);let m=Object.entries(i.MODULE_DEFINITIONS).filter(([e])=>"files"!==e).map(([e,t])=>({value:e,label:t.label})),u=new Set(m.map(e=>e.value)),x=[{value:"all",label:"全部模組"},...m],p={module:"all",entityId:"",keyword:""},b={module:"materials",entityId:"",title:"",description:"",tags:"",isPrimary:!1},h=e=>{if(!e)return"—";let t=e.toDate();return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},f=e=>e.split(/[,\s]+/).map(e=>e.trim()).filter(Boolean);function y(){let{user:e,claims:y}=(0,n.useAuth)(),{can:v}=(0,o.usePermission)(),w=v("files","view"),g=v("files","create"),j=v("files","update"),N=v("files","disable"),I=y?.roles?.includes("admin"),[k,P]=(0,l.useState)(p),[S,C]=(0,l.useState)(p),[M,E]=(0,l.useState)([]),[A,T]=(0,l.useState)(!1),[D,B]=(0,l.useState)(null),[F,O]=(0,l.useState)(0),[U,q]=(0,l.useState)(null),[L,$]=(0,l.useState)({title:"",description:"",tags:"",isPrimary:!1}),[z,R]=(0,l.useState)(!1),[_,K]=(0,l.useState)(null),[W,H]=(0,l.useState)(!1),[Y,G]=(0,l.useState)(!1),[J,Q]=(0,l.useState)(b),[V,X]=(0,l.useState)(null),[Z,ee]=(0,l.useState)(null),[et,es]=(0,l.useState)(!1),[el,ea]=(0,l.useState)(null),er=(0,s.useSearchParams)();(0,l.useEffect)(()=>{let e=er.get("module"),t=er.get("entityId"),s=e&&u.has(e)?e:null;(s||t)&&(P(e=>({...e,module:s??e.module,entityId:t??e.entityId})),C(e=>({...e,module:s??e.module,entityId:t??e.entityId})))},[er]),(0,l.useEffect)(()=>{if(!w)return;let e=!0,t=U?.id??null;return(async()=>{T(!0),B(null);try{let s=[];"all"!==S.module&&s.push((0,a.where)("targetModule","==",S.module)),S.entityId.trim()&&s.push((0,a.where)("entityId","==",S.entityId.trim())),s.push((0,a.limit)(100));let l=await (0,a.getDocs)((0,a.query)((0,a.collection)(d.db,"files"),...s));if(!e)return;let i=[];for(let e of l.docs){let t=e.data();if(t.deletedAt)continue;let s={id:e.id,targetModule:t.targetModule??"materials",entityId:t.entityId??"",storagePath:t.storagePath??"",fileName:t.fileName??e.id,mimeType:t.mimeType??"application/octet-stream",size:"number"==typeof t.size?t.size:void 0,title:t.title??void 0,description:t.description??void 0,tags:Array.isArray(t.tags)?t.tags:[],isPrimary:!0===t.isPrimary,orderIndex:"number"==typeof t.orderIndex?t.orderIndex:void 0,createdAt:t.createdAt,createdByUid:t.createdByUid??void 0,createdByName:t.createdByName??void 0,deletedAt:void 0};if(s.mimeType.startsWith("image/")&&s.storagePath)try{s.downloadURL=await (0,r.getDownloadURL)((0,r.ref)(d.storage,s.storagePath))}catch(e){console.warn("Failed to load file preview",e)}i.push(s)}let o=S.keyword.trim().toLowerCase(),n=o?i.filter(e=>[e.fileName,e.title??"",e.description??"",e.entityId,e.tags?.join(" ")??""].join(" ").toLowerCase().includes(o)):i;if(n.sort((e,t)=>{if(e.isPrimary!==t.isPrimary)return e.isPrimary?-1:1;let s=e.orderIndex??e.createdAt?.toDate().getTime()??0;return(t.orderIndex??t.createdAt?.toDate().getTime()??0)-s}),!e)return;if(E(n),t){let e=n.find(e=>e.id===t)??null;q(e)}}catch(t){if(!e)return;console.error("Failed to load files",t),B("讀取檔案中心資料時發生錯誤，請稍後再試。")}finally{e&&T(!1)}})(),()=>{e=!1}},[S,F,w,U?.id]),(0,l.useEffect)(()=>{U&&($({title:U.title??"",description:U.description??"",tags:U.tags?.join(", ")??"",isPrimary:!!U.isPrimary}),K(null))},[U]);let ei=()=>{let e="all"!==k.module?k.module:b.module;Q(t=>({...t,module:e,entityId:k.entityId})),X(null),ee(null),G(!0)},ed=()=>O(e=>e+1),eo=async t=>{if(t.preventDefault(),!V||0===V.length)return void ee("請選擇至少一個檔案");if(!J.entityId.trim())return void ee("請輸入關聯的主檔編號");es(!0),ee(null);try{let t=J.entityId.trim(),s=f(J.tags);await (0,c.uploadFilesForEntity)({module:J.module,entityId:t,files:Array.from(V),metadata:{title:J.title,description:J.description,tags:s,setPrimary:J.isPrimary},createdBy:{uid:e?.uid??null,name:e?.email??e?.displayName??"system"}}),G(!1),X(null),Q(e=>({...e,title:"",description:"",tags:"",isPrimary:!1})),ea("已完成檔案上傳"),ed()}catch(e){console.error("Failed to upload files",e),ee("上傳失敗，請稍後再試")}finally{es(!1)}},en=async()=>{if(U&&j){R(!0),K(null);try{let e=f(L.tags);L.isPrimary&&await (0,c.clearExistingPrimary)(U.targetModule,U.entityId,U.id),await (0,a.updateDoc)((0,a.doc)(d.db,"files",U.id),{title:L.title.trim()||null,description:L.description.trim()||null,tags:e,isPrimary:L.isPrimary,updatedAt:(0,a.serverTimestamp)()}),ea("已更新檔案資訊"),ed()}catch(e){console.error("Failed to update file metadata",e),K("更新檔案資訊失敗，請稍後再試。")}finally{R(!1)}}},ec=async()=>{if(U&&N&&window.confirm("確定要刪除這個檔案嗎？此動作無法復原。")){H(!0),K(null);try{await (0,a.deleteDoc)((0,a.doc)(d.db,"files",U.id)),U.storagePath&&await (0,r.deleteObject)((0,r.ref)(d.storage,U.storagePath)),q(null),ea("檔案已刪除"),ed()}catch(e){console.error("Failed to delete file",e),K("刪除失敗，請稍後再試。")}finally{H(!1)}}},em=(0,l.useMemo)(()=>{let e=new Map;return Object.entries(i.MODULE_DEFINITIONS).forEach(([t,s])=>e.set(t,s.label)),e},[]);return w||I?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"File Center"}),(0,t.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"檔案中心模組"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"集中管理設計圖、圖紙與關聯附件"})]}),g&&(0,t.jsx)("button",{onClick:ei,className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white disabled:bg-slate-400",children:"上傳檔案"})]}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),C(k)},className:"mt-6 grid gap-4 md:grid-cols-4",children:[(0,t.jsxs)("label",{className:"text-sm font-semibold text-slate-600",children:["模組",(0,t.jsx)("select",{value:k.module,onChange:e=>P(t=>({...t,module:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:x.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("label",{className:"text-sm font-semibold text-slate-600",children:["關聯主檔編號",(0,t.jsx)("input",{type:"text",value:k.entityId,onChange:e=>P(t=>({...t,entityId:e.target.value})),placeholder:"例如：PM-00001-00001",className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"md:col-span-2 text-sm font-semibold text-slate-600",children:["關鍵字（檔名 / 標題 / 標籤）",(0,t.jsx)("input",{type:"text",value:k.keyword,onChange:e=>P(t=>({...t,keyword:e.target.value})),placeholder:"輸入關鍵字搜尋",className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-end justify-end gap-3 md:col-span-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{P(p),C(p)},className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"重置"}),(0,t.jsx)("button",{type:"submit",className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm",children:"套用搜尋"})]})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-slate-500",children:A?"資料載入中…":`已載入 ${M.length} 筆檔案（僅顯示最近 100 筆）`}),el&&(0,t.jsx)("p",{className:"text-xs text-emerald-600",children:el}),D&&(0,t.jsx)("p",{className:"text-xs text-red-600",children:D})]}),g&&(0,t.jsx)("button",{onClick:ei,className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700",children:"新增檔案"})]}),(0,t.jsx)("div",{className:"mt-4 overflow-x-auto rounded-xl border border-slate-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-slate-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-slate-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"預覽"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"模組 / 關聯"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"檔案資訊"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"標籤"}),(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"建立資訊"}),(0,t.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold uppercase tracking-wide text-slate-500",children:"操作"})]})}),(0,t.jsxs)("tbody",{className:"divide-y divide-slate-50",children:[M.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-slate-50",children:[(0,t.jsx)("td",{className:"px-4 py-3",children:e.downloadURL&&e.mimeType.startsWith("image/")?(0,t.jsx)("img",{src:e.downloadURL,alt:e.fileName,className:"h-14 w-14 rounded-lg object-cover"}):(0,t.jsx)("div",{className:"flex h-14 w-14 items-center justify-center rounded-lg bg-slate-100 text-xs text-slate-500",children:e.mimeType.split("/")[1]?.toUpperCase()??"FILE"})}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:em.get(e.targetModule)??e.targetModule}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:e.entityId||"—"})]}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.title??e.fileName}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:e.fileName}),(0,t.jsxs)("p",{className:"text-xs text-slate-400",children:[e.mimeType," · ",e.size?`${(e.size/1024).toFixed(1)} KB`:"大小不明"]}),e.isPrimary&&(0,t.jsx)("span",{className:"mt-1 inline-flex rounded-full bg-amber-50 px-2 py-0.5 text-[11px] font-semibold text-amber-700",children:"主圖"})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tags?.length?e.tags.map(s=>(0,t.jsx)("span",{className:"rounded-full bg-slate-900/5 px-3 py-1 text-xs font-semibold text-slate-600",children:s},`${e.id}-${s}`)):"—"})}),(0,t.jsxs)("td",{className:"px-4 py-3 text-xs text-slate-500",children:[(0,t.jsx)("p",{children:e.createdByName??e.createdByUid??"未知"}),(0,t.jsx)("p",{children:h(e.createdAt)})]}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)("button",{onClick:()=>q(e),className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-700",children:"預覽"})})]},e.id)),!M.length&&!A&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"px-4 py-6 text-center text-sm text-slate-500",children:"尚無符合條件的檔案紀錄"})})]})]})})]}),Y&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Upload"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"上傳檔案"}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"指定關聯模組與主檔代碼"})]}),(0,t.jsx)("button",{onClick:()=>G(!1),className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("form",{onSubmit:eo,className:"mt-4 space-y-4",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["關聯模組",(0,t.jsx)("select",{value:J.module,onChange:e=>Q(t=>({...t,module:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",children:m.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["主檔編號",(0,t.jsx)("input",{type:"text",value:J.entityId,onChange:e=>Q(t=>({...t,entityId:e.target.value})),placeholder:"例如：PM-00001-00001",className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["檔案標題（選填，未填則使用檔名）",(0,t.jsx)("input",{type:"text",value:J.title,onChange:e=>Q(t=>({...t,title:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["說明（選填）",(0,t.jsx)("textarea",{value:J.description,onChange:e=>Q(t=>({...t,description:e.target.value})),rows:3,className:"mt-1 w-full rounded-2xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none",placeholder:"輸入簡短說明，方便搜尋與辨識"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["標籤（以逗號或空白分隔）",(0,t.jsx)("input",{type:"text",value:J.tags,onChange:e=>Q(t=>({...t,tags:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-4 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:J.isPrimary,onChange:e=>Q(t=>({...t,isPrimary:e.target.checked})),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"設為此主檔的主圖（僅第一個檔案會套用）"]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["選擇檔案",(0,t.jsx)("input",{type:"file",multiple:!0,onChange:e=>X(e.target.files),className:"mt-1 w-full text-sm"}),(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"支援多檔同時上傳，建議單檔不超過 10MB。"})]}),Z&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:Z}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>G(!1),className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"取消"}),(0,t.jsx)("button",{type:"submit",disabled:et,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:opacity-50",children:et?"上傳中…":"開始上傳"})]})]})]})}),U&&(0,t.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/50 px-4 py-8",children:(0,t.jsxs)("div",{className:"w-full max-w-xl max-h-[90vh] overflow-y-auto rounded-2xl bg-white p-6 shadow-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-teal-600",children:"Preview"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:U.title??U.fileName}),(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:[em.get(U.targetModule)??U.targetModule," ·"," ",U.entityId||"未指定"]})]}),(0,t.jsx)("button",{onClick:()=>q(null),className:"rounded-full px-3 py-1 text-sm text-slate-500 hover:bg-slate-100",children:"關閉"})]}),(0,t.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-100 p-4",children:[U.downloadURL&&U.mimeType.startsWith("image/")?(0,t.jsx)("img",{src:U.downloadURL,alt:U.fileName,className:"max-h-[320px] w-full rounded-xl object-contain"}):(0,t.jsx)("div",{className:"flex h-40 items-center justify-center rounded-xl bg-slate-50 text-sm text-slate-500",children:"無法預覽此檔案，請使用下載連結檢視。"}),(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-sm text-slate-600",children:[(0,t.jsx)("a",{href:U.downloadURL,target:"_blank",rel:"noreferrer",className:"rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-700",children:"下載檔案"}),(0,t.jsx)("span",{children:U.fileName}),(0,t.jsx)("span",{children:U.mimeType}),(0,t.jsx)("span",{children:U.size?`${(U.size/1024).toFixed(1)} KB`:"大小不明"}),(0,t.jsx)("span",{children:h(U.createdAt)})]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"檔案資訊"}),(0,t.jsxs)("div",{className:"mt-3 space-y-3 text-sm text-slate-600",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"關聯主檔編號"}),(0,t.jsx)("p",{className:"mt-1 font-semibold text-slate-900",children:U.entityId||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"標籤"}),(0,t.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:U.tags?.length?U.tags.map(e=>(0,t.jsx)("span",{className:"rounded-full bg-slate-900/5 px-3 py-1 text-xs font-semibold text-slate-600",children:e},`${U.id}-${e}`)):"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-slate-500",children:"建立資訊"}),(0,t.jsxs)("p",{className:"mt-1 text-xs text-slate-500",children:[U.createdByName??U.createdByUid??"未知"," ·"," ",h(U.createdAt)]})]})]})]}),j&&(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-100 p-4",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"編輯資訊"}),(0,t.jsxs)("div",{className:"mt-3 space-y-3",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["標題",(0,t.jsx)("input",{type:"text",value:L.title,onChange:e=>$(t=>({...t,title:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["說明",(0,t.jsx)("textarea",{value:L.description,onChange:e=>$(t=>({...t,description:e.target.value})),rows:3,className:"mt-1 w-full rounded-2xl border border-slate-200 px-3 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"block text-sm font-semibold text-slate-600",children:["標籤",(0,t.jsx)("input",{type:"text",value:L.tags,onChange:e=>$(t=>({...t,tags:e.target.value})),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-teal-500 focus:outline-none"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-slate-600",children:[(0,t.jsx)("input",{type:"checkbox",checked:L.isPrimary,onChange:e=>$(t=>({...t,isPrimary:e.target.checked})),className:"h-4 w-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"}),"設為此主檔主圖"]}),_&&(0,t.jsx)("p",{className:"text-sm font-semibold text-red-600",children:_}),(0,t.jsxs)("div",{className:"flex flex-wrap justify-between gap-3 pt-2",children:[N&&(0,t.jsx)("button",{type:"button",onClick:ec,disabled:W,className:"rounded-full border border-red-200 px-4 py-2 text-sm font-semibold text-red-600 disabled:opacity-50",children:W?"刪除中…":"刪除檔案"}),(0,t.jsxs)("div",{className:"ml-auto flex gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>q(null),className:"rounded-full border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-600",children:"關閉"}),(0,t.jsx)("button",{type:"button",onClick:en,disabled:z,className:"rounded-full bg-teal-600 px-5 py-2 text-sm font-semibold text-white shadow-sm disabled:opacity-50",children:z?"儲存中…":"儲存變更"})]})]})]})]})]})]})})]}):(0,t.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 text-center text-sm text-slate-600",children:"目前帳號尚未獲得「檔案中心」權限，請聯絡系統管理員。"})}e.s(["FileCenter",()=>y])}]);